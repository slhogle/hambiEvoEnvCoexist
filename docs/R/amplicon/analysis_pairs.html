<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shane Hogle">
<meta name="dcterms.date" content="2024-09-11">

<title>hambiBottomUp data analysis - Analysis of pairwise competition</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../R/amplicon/20240711_BTK_illumina_v3/01_format_rbec_tab.html">Community composition amplicon</a></li><li class="breadcrumb-item"><a href="../../R/amplicon/analysis_pairs.html">3. Species pairs analysis</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">hambiBottomUp data analysis</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Experiment design - 96 Well plate layout</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../R/experiment_design/01_pairs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Species pairs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../R/experiment_design/02_trios.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Species trios</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../R/experiment_design/03_quartets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Species quartets</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Community composition amplicon</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../R/amplicon/20240711_BTK_illumina_v3/01_format_rbec_tab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. 20240711 BTK Illumina v3 / Data wrangling and QC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../R/amplicon/20240711_BTK_illumina_v3/02_correct_boil_to_qiagen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. 20240711 BTK Illumina v3 / Metacal calibration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../R/amplicon/analysis_pairs.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">3. Species pairs analysis</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup"><span class="header-section-number">2</span> Setup</a>
  <ul class="collapse">
  <li><a href="#libraries" id="toc-libraries" class="nav-link" data-scroll-target="#libraries"><span class="header-section-number">2.1</span> Libraries</a></li>
  <li><a href="#global-variables" id="toc-global-variables" class="nav-link" data-scroll-target="#global-variables"><span class="header-section-number">2.2</span> Global variables</a></li>
  </ul></li>
  <li><a href="#read-data" id="toc-read-data" class="nav-link" data-scroll-target="#read-data"><span class="header-section-number">3</span> Read data</a>
  <ul class="collapse">
  <li><a href="#metadata" id="toc-metadata" class="nav-link" data-scroll-target="#metadata"><span class="header-section-number">3.1</span> Metadata</a></li>
  <li><a href="#species-abundances" id="toc-species-abundances" class="nav-link" data-scroll-target="#species-abundances"><span class="header-section-number">3.2</span> Species abundances</a></li>
  </ul></li>
  <li><a href="#formatting" id="toc-formatting" class="nav-link" data-scroll-target="#formatting"><span class="header-section-number">4</span> Formatting</a>
  <ul class="collapse">
  <li><a href="#transfer-0-starting-proportions" id="toc-transfer-0-starting-proportions" class="nav-link" data-scroll-target="#transfer-0-starting-proportions"><span class="header-section-number">4.1</span> Transfer 0 (starting proportions)</a></li>
  <li><a href="#transfer-8-ending-proportions" id="toc-transfer-8-ending-proportions" class="nav-link" data-scroll-target="#transfer-8-ending-proportions"><span class="header-section-number">4.2</span> Transfer 8 (ending proportions)</a></li>
  </ul></li>
  <li><a href="#define-competition-outcomes" id="toc-define-competition-outcomes" class="nav-link" data-scroll-target="#define-competition-outcomes"><span class="header-section-number">5</span> Define competition outcomes</a>
  <ul class="collapse">
  <li><a href="#binomial-sampling-and-wilcox-test" id="toc-binomial-sampling-and-wilcox-test" class="nav-link" data-scroll-target="#binomial-sampling-and-wilcox-test"><span class="header-section-number">5.1</span> Binomial sampling and Wilcox test</a></li>
  <li><a href="#competition-outcome-rules" id="toc-competition-outcome-rules" class="nav-link" data-scroll-target="#competition-outcome-rules"><span class="header-section-number">5.2</span> Competition outcome rules</a></li>
  <li><a href="#plotting-pairwise-outpcomes" id="toc-plotting-pairwise-outpcomes" class="nav-link" data-scroll-target="#plotting-pairwise-outpcomes"><span class="header-section-number">5.3</span> Plotting pairwise outpcomes</a></li>
  </ul></li>
  <li><a href="#network" id="toc-network" class="nav-link" data-scroll-target="#network"><span class="header-section-number">6</span> Network</a>
  <ul class="collapse">
  <li><a href="#functions-for-formatting-and-plotting" id="toc-functions-for-formatting-and-plotting" class="nav-link" data-scroll-target="#functions-for-formatting-and-plotting"><span class="header-section-number">6.1</span> Functions for formatting and plotting</a></li>
  <li><a href="#evolution-and-streptomycin-categories-separate" id="toc-evolution-and-streptomycin-categories-separate" class="nav-link" data-scroll-target="#evolution-and-streptomycin-categories-separate"><span class="header-section-number">6.2</span> Evolution and Streptomycin categories separate</a></li>
  <li><a href="#only-streptomycin-category-separate" id="toc-only-streptomycin-category-separate" class="nav-link" data-scroll-target="#only-streptomycin-category-separate"><span class="header-section-number">6.3</span> Only Streptomycin category separate</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../R/amplicon/20240711_BTK_illumina_v3/01_format_rbec_tab.html">Community composition amplicon</a></li><li class="breadcrumb-item"><a href="../../R/amplicon/analysis_pairs.html">3. Species pairs analysis</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Analysis of pairwise competition</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Shane Hogle </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 11, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Contains results from pairs of all streptomycin concentrations and trios for 0 streptomycin from Milla’s bottom up community assembly experiment</p>
</section>
<section id="setup" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Setup</h1>
<section id="libraries" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="libraries"><span class="header-section-number">2.1</span> Libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(here)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(fs)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(ggh4x)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"utils_generic.R"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="global-variables" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="global-variables"><span class="header-section-number">2.2</span> Global variables</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>data_raw <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"_data_raw"</span>, <span class="st">"20240711_BTK_illumina_v3"</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a>data <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"20240711_BTK_illumina_v3"</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co"># make processed data directory if it doesn't exist</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>fs<span class="sc">::</span><span class="fu">dir_create</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="read-data" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Read data</h1>
<section id="metadata" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="metadata"><span class="header-section-number">3.1</span> Metadata</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>mddf <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(here<span class="sc">::</span><span class="fu">here</span>(data_raw, <span class="st">"20240711_BTK_illumina_v3_metadata.tsv"</span>))</span>
<span id="cb3-2"><a href="#cb3-2"></a>spdf <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(here<span class="sc">::</span><span class="fu">here</span>(data_raw, <span class="st">"sample_compositions.tsv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="species-abundances" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="species-abundances"><span class="header-section-number">3.2</span> Species abundances</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>samp_pairs <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(here<span class="sc">::</span><span class="fu">here</span>(data, <span class="st">"pairs_counts.tsv"</span>))</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">#samp_trios &lt;- readr::read_tsv(here::here(data, "trios_counts.tsv"))</span></span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a>samp_pairs_cal <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(here<span class="sc">::</span><span class="fu">here</span>(data, <span class="st">"pairs_metacal.tsv"</span>))</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#samp_trios_cal &lt;- readr::read_tsv(here::here(data, "trios_metacal.tsv"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="formatting" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Formatting</h1>
<section id="transfer-0-starting-proportions" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="transfer-0-starting-proportions"><span class="header-section-number">4.1</span> Transfer 0 (starting proportions)</h2>
<p>First get abundances from transfer 0 (masterplate)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>samp_pairs_fmt_mp <span class="ot">&lt;-</span> samp_pairs <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(community_type <span class="sc">==</span> <span class="st">"masterplate"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="co"># make a combined evolution and species identifier and extract the community ID</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sp =</span> <span class="fu">paste</span>(<span class="fu">str_to_upper</span>(evo_hist), <span class="fu">str_extract</span>(strainID, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>), <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb5-5"><a href="#cb5-5"></a>         <span class="at">community_id =</span> <span class="fu">str_extract</span>(sample, <span class="st">"P</span><span class="sc">\\</span><span class="st">d</span><span class="sc">\\</span><span class="st">d"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="co"># this step is important to ensure that when dfs are pivoted wider the </span></span>
<span id="cb5-7"><a href="#cb5-7"></a>  <span class="co"># sp_1 and sp_2 stay consistent </span></span>
<span id="cb5-8"><a href="#cb5-8"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(community_id, sp) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>  <span class="co"># this creates an index for each species present in each community, it is needed</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>  <span class="co"># for the pivot to be consistent between the master plate and the samples</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(community_id) <span class="sc">%&gt;%</span> </span>
<span id="cb5-12"><a href="#cb5-12"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb5-13"><a href="#cb5-13"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-14"><a href="#cb5-14"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> community_id, <span class="at">values_from =</span> <span class="fu">c</span>(sp, f), <span class="at">names_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb5-15"><a href="#cb5-15"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">transfer =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-16"><a href="#cb5-16"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">strep_conc =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">16</span>, <span class="dv">64</span>, <span class="dv">256</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="transfer-8-ending-proportions" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="transfer-8-ending-proportions"><span class="header-section-number">4.2</span> Transfer 8 (ending proportions)</h2>
<p>Format abundances from the experiment, summarizing over replicates. Here we calculate the median frequency across biological replicates using <code>Hmisc::smedian.hilow</code> which computes the sample median and the outer quantiles (0.025 and 0.975).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>samp_pairs_fmt_exp <span class="ot">&lt;-</span> samp_pairs <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(community_type <span class="sc">==</span> <span class="st">"experiment"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="co"># make a combined evolution and species identifier and extract the community ID</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sp =</span> <span class="fu">paste</span>(<span class="fu">str_to_upper</span>(evo_hist), <span class="fu">str_extract</span>(strainID, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>), <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb6-5"><a href="#cb6-5"></a>         <span class="at">community_id =</span> <span class="fu">str_extract</span>(sample, <span class="st">"P</span><span class="sc">\\</span><span class="st">d</span><span class="sc">\\</span><span class="st">d"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="co"># calculate median and 95% CI across replicates</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(ggplot2<span class="sc">::</span><span class="fu">median_hilow</span>(f), <span class="at">.by =</span> <span class="fu">c</span>(<span class="st">"community_id"</span>, <span class="st">"sp"</span>, <span class="st">"strep_conc"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="co"># rename the y columns as f for compatibility</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">"y"</span>), \(x) <span class="fu">str_replace</span>(x, <span class="st">"y"</span>, <span class="st">"f"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="#cb6-10"></a>  <span class="co"># this step is important to ensure that when dfs are pivoted wider the </span></span>
<span id="cb6-11"><a href="#cb6-11"></a>  <span class="co"># sp_1 and sp_2 stay consistent </span></span>
<span id="cb6-12"><a href="#cb6-12"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(community_id, sp, strep_conc) <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>  <span class="co"># this creates an index for each species present in each community, it is needed</span></span>
<span id="cb6-14"><a href="#cb6-14"></a>  <span class="co"># for the pivot to be consistent between the master plate and the samples</span></span>
<span id="cb6-15"><a href="#cb6-15"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(community_id, strep_conc) <span class="sc">%&gt;%</span> </span>
<span id="cb6-16"><a href="#cb6-16"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb6-17"><a href="#cb6-17"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-18"><a href="#cb6-18"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(community_id, strep_conc), <span class="at">values_from =</span> <span class="fu">c</span>(sp, f, fmin, fmax), <span class="at">names_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb6-19"><a href="#cb6-19"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">transfer =</span> <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="define-competition-outcomes" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Define competition outcomes</h1>
<section id="binomial-sampling-and-wilcox-test" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="binomial-sampling-and-wilcox-test"><span class="header-section-number">5.1</span> Binomial sampling and Wilcox test</h2>
<p>First need to determine which samples significantly decreased/increased from T0 to T8. We don’t have enough biological replicates for to compute a statistic across replicates for <a href="https://www.pnas.org/doi/10.1073/pnas.2302491120">outcome variability</a>. However, we can estimate the mean fraction of A and quantify the inferential uncertainty of the mean by bootstrap resampling. We the used median proportion of species A from two biological replicates of each T8 pair as the probability of success (i.e., drawing species A) from 1000 draws (i.e., sequencing reads) from the binomial distribution. To determine whether the frequency of Species A significantly changed from T0 to T8, the means of the 1000 binomial draws for T0 and T8 were compared using a Wilcoxon rank sum test (N = 2000). Tests with Bonferroni multiple test corrected p values &lt; 1e-5 were considered to represent significantly different T0 and T8 samples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">set.seed</span>(<span class="dv">124341</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co"># first join the T0 and T8 abundances</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>wc_test <span class="ot">&lt;-</span> <span class="fu">left_join</span>(samp_pairs_fmt_exp, samp_pairs_fmt_mp, <span class="at">by =</span> <span class="fu">join_by</span>(community_id, strep_conc, sp_1, sp_2)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">delta_f_1 =</span> f_1.x <span class="sc">-</span> f_1.y) <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(community_id, strep_conc, sp_1, sp_2, delta_f_1, <span class="at">f_1_8 =</span> f_1.x, <span class="at">f_1_0 =</span> f_1.y, </span>
<span id="cb7-7"><a href="#cb7-7"></a>                <span class="at">f_2_8 =</span> f_2.x, <span class="at">f_2_0 =</span> f_2.y) <span class="sc">%&gt;%</span> </span>
<span id="cb7-8"><a href="#cb7-8"></a>  tidyr<span class="sc">::</span><span class="fu">nest</span>(<span class="at">data =</span> <span class="fu">c</span>(<span class="sc">-</span>community_id, <span class="sc">-</span>strep_conc)) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="co"># samples 1000 draws from binomial distribution using f_a median as the probability of success</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">f_1_0_rs =</span> purrr<span class="sc">::</span><span class="fu">map</span>(data, \(x) <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, \(i) <span class="fu">sum</span>(<span class="fu">rbinom</span>(<span class="dv">1000</span>, <span class="dv">1</span>, x<span class="sc">$</span>f_1_0))<span class="sc">/</span><span class="dv">1000</span>)),</span>
<span id="cb7-11"><a href="#cb7-11"></a>         <span class="at">f_1_8_rs =</span> purrr<span class="sc">::</span><span class="fu">map</span>(data, \(x) <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, \(i) <span class="fu">sum</span>(<span class="fu">rbinom</span>(<span class="dv">1000</span>, <span class="dv">1</span>, x<span class="sc">$</span>f_1_8))<span class="sc">/</span><span class="dv">1000</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb7-12"><a href="#cb7-12"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(data, f_1_0_rs, f_1_8_rs)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-13"><a href="#cb7-13"></a>  <span class="co"># nest the samples</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>  tidyr<span class="sc">::</span><span class="fu">nest</span>(<span class="at">bs =</span> <span class="fu">c</span>(f_1_0_rs, f_1_8_rs)) <span class="sc">%&gt;%</span></span>
<span id="cb7-15"><a href="#cb7-15"></a>  <span class="co"># perform the wilcox test</span></span>
<span id="cb7-16"><a href="#cb7-16"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">wc =</span> purrr<span class="sc">::</span><span class="fu">map</span>(bs, \(i) <span class="fu">wilcox.test</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(i<span class="sc">$</span>f_1_0_rs), <span class="at">y =</span> <span class="fu">as.numeric</span>(i<span class="sc">$</span>f_1_8_rs)))) <span class="sc">%&gt;%</span> </span>
<span id="cb7-17"><a href="#cb7-17"></a>  <span class="co"># tidy-ify the test output</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">tidy_wc =</span> purrr<span class="sc">::</span><span class="fu">map</span>(wc, \(x) broom<span class="sc">::</span><span class="fu">tidy</span>(x))) <span class="sc">%&gt;%</span> </span>
<span id="cb7-19"><a href="#cb7-19"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(tidy_wc)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-20"><a href="#cb7-20"></a>  <span class="co"># p-value adjust using bonferroni correction</span></span>
<span id="cb7-21"><a href="#cb7-21"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">p_adjusted =</span> <span class="fu">p.adjust</span>(p.value, <span class="at">method =</span> <span class="st">"bonferroni"</span>, <span class="at">n =</span> <span class="fu">n</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb7-22"><a href="#cb7-22"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(strep_conc, sp_1, sp_2) <span class="sc">%&gt;%</span> </span>
<span id="cb7-23"><a href="#cb7-23"></a>  <span class="co"># define whether change is significantly positive or negative</span></span>
<span id="cb7-24"><a href="#cb7-24"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">change =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(p.value <span class="sc">&gt;</span> <span class="fl">1e-5</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb7-25"><a href="#cb7-25"></a>                             <span class="fu">sign</span>(delta_f_1) <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">&amp;</span> p.value <span class="sc">&lt;=</span> <span class="fl">1e-5</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb7-26"><a href="#cb7-26"></a>                             <span class="fu">sign</span>(delta_f_1) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> p.value <span class="sc">&lt;=</span> <span class="fl">1e-5</span> <span class="sc">~</span> <span class="dv">1</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="competition-outcome-rules" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="competition-outcome-rules"><span class="header-section-number">5.2</span> Competition outcome rules</h2>
<p>Here we set up the rules for defining the competition outcomes.</p>
<p>Need to write these down formally instead of just in the <code>case_when</code> statement…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># upper threshold for deciding whether a species goes extinct</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>upper <span class="ot">&lt;-</span> <span class="fl">0.99</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co"># lower threshold for deciding whether a species goes extinct</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>lower <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co"># slope change threshold for deciding whether change from T0 to T8 is important (e.g. requires at least a 5% change of the focal species) </span></span>
<span id="cb8-6"><a href="#cb8-6"></a>slope_thresh <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a>outcomes_classified <span class="ot">&lt;-</span> wc_test <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="#cb8-9"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(strep_conc, sp_1, sp_2) <span class="sc">%&gt;%</span> </span>
<span id="cb8-10"><a href="#cb8-10"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">outcome =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(<span class="co"># Bistability: Requires sp_1 to both increase from T0 high freq and decrease from T0 low freq</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>                             <span class="fu">sum</span>(change <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> f_1_0 <span class="sc">==</span> <span class="fu">min</span>(f_1_0), change <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> f_1_0 <span class="sc">==</span> <span class="fu">max</span>(f_1_0)) <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"bistable_stable"</span>,</span>
<span id="cb8-12"><a href="#cb8-12"></a>                             <span class="co"># Exclusion: sp_1 increases from both low and high T0 freqs and T8 freq is &gt; than the T0 high freq</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>                             <span class="fu">sum</span>(change) <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> f_1_8 <span class="sc">&gt;=</span> upper <span class="sc">&amp;</span> <span class="fu">abs</span>(delta_f_1) <span class="sc">&gt;</span> slope_thresh <span class="sc">~</span> <span class="st">"exclusion_stable"</span>, </span>
<span id="cb8-14"><a href="#cb8-14"></a>                             <span class="co"># Exclusion: sp_1 decreases from both low and high T0 freqs and T8 freq is &lt; than the T0 low freq</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>                             <span class="fu">sum</span>(change) <span class="sc">==</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">&amp;</span> f_1_8 <span class="sc">&lt;=</span> lower <span class="sc">&amp;</span> <span class="fu">abs</span>(delta_f_1) <span class="sc">&gt;</span> slope_thresh <span class="sc">~</span> <span class="st">"exclusion_stable"</span>,</span>
<span id="cb8-16"><a href="#cb8-16"></a>                             <span class="co"># Coexistence: sp_1 significantly increases from rare and significantly decreases from abundant</span></span>
<span id="cb8-17"><a href="#cb8-17"></a>                             <span class="fu">sum</span>(change) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(f_1_0 <span class="sc">==</span> <span class="fu">pmin</span>(f_1_0, f_2_0), f_1_8 <span class="sc">&gt;</span> f_1_0, f_1_8 <span class="sc">&lt;</span> f_1_0) <span class="sc">~</span> <span class="st">"coexistence_stable"</span>,</span>
<span id="cb8-18"><a href="#cb8-18"></a>                             <span class="co"># Incomplete coexistence: sp_1 is found within extinction thresholds in both experiments, but no condition is</span></span>
<span id="cb8-19"><a href="#cb8-19"></a>                             <span class="co"># placed on the significance of the change from T0 to T8</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>                             <span class="fu">sum</span>(dplyr<span class="sc">::</span><span class="fu">between</span>(f_1_8, lower, upper)) <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"coexistence_incomplete"</span>,</span>
<span id="cb8-21"><a href="#cb8-21"></a>                             <span class="co"># Incomplete exclusion: sp_1 is outside of the extinction threshold (extinct) for at least one sample and within the the </span></span>
<span id="cb8-22"><a href="#cb8-22"></a>                             <span class="co"># threshold for the other sample.</span></span>
<span id="cb8-23"><a href="#cb8-23"></a>                             <span class="fu">sum</span>(<span class="sc">!</span>dplyr<span class="sc">::</span><span class="fu">between</span>(f_1_8, lower, upper)) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">sum</span>(dplyr<span class="sc">::</span><span class="fu">between</span>(f_1_8, lower, upper)) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"exclusion_incomplete"</span>,</span>
<span id="cb8-24"><a href="#cb8-24"></a>                             <span class="co"># Inconclusive: samples failing to meet any of the above rules</span></span>
<span id="cb8-25"><a href="#cb8-25"></a>                             <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"inconclusive_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-26"><a href="#cb8-26"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-27"><a href="#cb8-27"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">type =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(outcome, <span class="st">"incomplete"</span>), <span class="st">"incomplete"</span>, <span class="st">"stable"</span>),</span>
<span id="cb8-28"><a href="#cb8-28"></a>         <span class="at">outcome =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(outcome, <span class="st">"(^.+)_.*"</span>, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-29"><a href="#cb8-29"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(outcome, type, change)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-pairwise-outpcomes" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="plotting-pairwise-outpcomes"><span class="header-section-number">5.3</span> Plotting pairwise outpcomes</h2>
<p>Construct final dataframe to be used for plotting</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>samp_pairs_fmt <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(samp_pairs_fmt_mp, samp_pairs_fmt_exp) <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="at">group =</span> <span class="fu">interaction</span>(community_id, strep_conc),</span>
<span id="cb9-4"><a href="#cb9-4"></a>    <span class="at">evo_group =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb9-5"><a href="#cb9-5"></a>      dplyr<span class="sc">::</span><span class="fu">if_all</span>(<span class="fu">c</span>(sp_1, sp_2), \(x) stringr<span class="sc">::</span><span class="fu">str_detect</span>(x, <span class="st">"ANC"</span>)) <span class="sc">~</span> <span class="st">"both_anc"</span>,</span>
<span id="cb9-6"><a href="#cb9-6"></a>      dplyr<span class="sc">::</span><span class="fu">if_all</span>(<span class="fu">c</span>(sp_1, sp_2), \(x) stringr<span class="sc">::</span><span class="fu">str_detect</span>(x, <span class="st">"EVO"</span>)) <span class="sc">~</span> <span class="st">"both_evo"</span>,</span>
<span id="cb9-7"><a href="#cb9-7"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"mix"</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>    )</span>
<span id="cb9-9"><a href="#cb9-9"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(outcomes_classified,</span>
<span id="cb9-11"><a href="#cb9-11"></a>                   <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(community_id, sp_1, sp_2, strep_conc)) <span class="sc">%&gt;%</span></span>
<span id="cb9-12"><a href="#cb9-12"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb9-13"><a href="#cb9-13"></a>    <span class="at">outcome =</span> <span class="fu">factor</span>(outcome, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"exclusion"</span>, <span class="st">"coexistence"</span>, </span>
<span id="cb9-14"><a href="#cb9-14"></a>                                         <span class="st">"bistable"</span>, <span class="st">"inconclusive"</span>)),</span>
<span id="cb9-15"><a href="#cb9-15"></a>    <span class="at">type =</span> <span class="fu">factor</span>(type, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"stable"</span>, <span class="st">"incomplete"</span>))</span>
<span id="cb9-16"><a href="#cb9-16"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting function and colors/linetypes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>outcome_pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"exclusion"</span> <span class="ot">=</span> <span class="st">"#800020"</span>, <span class="st">"coexistence"</span> <span class="ot">=</span> <span class="st">"#0659bf"</span>, <span class="st">"inconclusive"</span> <span class="ot">=</span> <span class="st">"#7c26c7"</span>, <span class="st">"bistable"</span> <span class="ot">=</span> <span class="st">"#098f07"</span>)</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>type_pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"stable"</span> <span class="ot">=</span> <span class="st">"solid"</span>, <span class="st">"incomplete"</span> <span class="ot">=</span> <span class="st">"dashed"</span>, <span class="st">"potential"</span> <span class="ot">=</span> <span class="st">"dotted"</span>)</span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a>pair_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb10-6"><a href="#cb10-6"></a>  pj <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">position_jitterdodge</span>(<span class="at">jitter.width=</span><span class="fl">0.0</span>,</span>
<span id="cb10-7"><a href="#cb10-7"></a>                           <span class="at">jitter.height =</span> <span class="fl">0.0</span>,</span>
<span id="cb10-8"><a href="#cb10-8"></a>                           <span class="at">dodge.width =</span> <span class="fl">0.5</span>,</span>
<span id="cb10-9"><a href="#cb10-9"></a>                           <span class="at">seed=</span><span class="dv">9</span>)</span>
<span id="cb10-10"><a href="#cb10-10"></a>  </span>
<span id="cb10-11"><a href="#cb10-11"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> transfer, <span class="at">y =</span> f_1, <span class="at">group =</span> group)) <span class="sc">+</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"grey70"</span>) <span class="sc">+</span></span>
<span id="cb10-13"><a href="#cb10-13"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"grey70"</span>) <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"grey70"</span>) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> fmin_1, <span class="at">ymax =</span> fmax_1, <span class="at">color =</span> outcome), <span class="at">position =</span> pj) <span class="sc">+</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>  ggh4x<span class="sc">::</span><span class="fu">geom_pointpath</span>(<span class="fu">aes</span>(<span class="at">color =</span> outcome, <span class="at">linetype =</span> type), <span class="at">position =</span> pj, <span class="at">mult =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> outcome_pal) <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> type_pal) <span class="sc">+</span></span>
<span id="cb10-19"><a href="#cb10-19"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(sp_1 <span class="sc">~</span> sp_2) <span class="sc">+</span></span>
<span id="cb10-20"><a href="#cb10-20"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">labels =</span> percent) <span class="sc">+</span></span>
<span id="cb10-21"><a href="#cb10-21"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb10-22"><a href="#cb10-22"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb10-23"><a href="#cb10-23"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb10-24"><a href="#cb10-24"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-25"><a href="#cb10-25"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-26"><a href="#cb10-26"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb10-27"><a href="#cb10-27"></a>        <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-28"><a href="#cb10-28"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb10-29"><a href="#cb10-29"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb10-30"><a href="#cb10-30"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create different lists of plots for the mixed (i.e.&nbsp;evo competed against anc) conditions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>samp_pairs_fmt_plots_split_a <span class="ot">&lt;-</span> samp_pairs_fmt <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(evo_group <span class="sc">!=</span> <span class="st">"mix"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(strep_conc, evo_group) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4"></a>  dplyr<span class="sc">::</span><span class="fu">group_split</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-5"><a href="#cb11-5"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(pair_plot)</span>
<span id="cb11-6"><a href="#cb11-6"></a></span>
<span id="cb11-7"><a href="#cb11-7"></a>samp_pairs_fmt_plots_split_b <span class="ot">&lt;-</span> samp_pairs_fmt <span class="sc">%&gt;%</span> </span>
<span id="cb11-8"><a href="#cb11-8"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(evo_group <span class="sc">==</span> <span class="st">"mix"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-9"><a href="#cb11-9"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(strep_conc) <span class="sc">%&gt;%</span> </span>
<span id="cb11-10"><a href="#cb11-10"></a>  dplyr<span class="sc">::</span><span class="fu">group_split</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-11"><a href="#cb11-11"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(pair_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-01" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-01-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(samp_pairs_fmt_plots_split_a, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_pairs_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-01-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Outcomes from pairwise cocultures of ancestral (left, A:G) and streptomycin adapted (right, B:H) 0403, 1287, 1896 and 1977 species. Rows in the grid represent differen streptomycin concentrations applied (A:B = 0 µg/ml, C:D = 16 µg/ml, E:F = 64 µg/ml, G:H = 256 µg/ml). Using the rules defined above, red lines show cocultures resulting in exclusion of one of the species, blue lines show cocultures that resulted in coexistence, and purple lines represent inconclusive outcomes due to lack of data or exception to therules. Solid lines show a “definite” outcome and dashed lines show a potentially “incomplete” outcome. Two solid lines of the same color indicate stable coexistence or stable exclusion, a solid and dashed line indicate incomplete coexistence/exclusion, while two dashed lines indicates coexistence without evidence of mutual invasibility. Note some statistical noise has been applied to point positions to prevent overlaps in the plot and aid in visualization.
</figcaption>
</figure>
</div>
<div id="fig-02" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(samp_pairs_fmt_plots_split_b, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>  patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_pairs_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Results from co-cultures of mixed ancestal and evolved combinations. Line colors and types are as in <a href="#fig-01" class="quarto-xref">Figure&nbsp;1</a>, with the addition of green showing bistability (i.e., Species A and Species B exclude each other when invading from high abundance, and each are excluded by the other when invading from low abundance).
</figcaption>
</figure>
</div>
</section>
</section>
<section id="network" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Network</h1>
<p>Here we will plot the pairwise competition outcomes as a network. <strong>NOTE:</strong> I don’t have time/energy to figure out how to manage all the links in the networks so that they line up properly and don’t overlap so there will need to be some postprocessing in inkscape to move some of the links so they don’t overlap.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">library</span>(ggraph)</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="fu">library</span>(tidygraph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="functions-for-formatting-and-plotting" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="functions-for-formatting-and-plotting"><span class="header-section-number">6.1</span> Functions for formatting and plotting</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>make_pairs <span class="ot">&lt;-</span> <span class="cf">function</span>(pairs_df, sp){</span>
<span id="cb15-2"><a href="#cb15-2"></a>  pairs_df <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(transfer <span class="sc">==</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(evo_group, strep_conc, sp_1, sp_2) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(evo_group, strep_conc) <span class="sc">%&gt;%</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>    dplyr<span class="sc">::</span><span class="fu">count</span>( {{ sp }} ) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="#cb15-7"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">sp =</span> {{ sp }} ) <span class="sc">%&gt;%</span> </span>
<span id="cb15-8"><a href="#cb15-8"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb15-9"><a href="#cb15-9"></a>}</span>
<span id="cb15-10"><a href="#cb15-10"></a></span>
<span id="cb15-11"><a href="#cb15-11"></a>make_nodes <span class="ot">&lt;-</span> <span class="cf">function</span>(pairs_df, ...){</span>
<span id="cb15-12"><a href="#cb15-12"></a>  sp_1 <span class="ot">&lt;-</span> <span class="fu">make_pairs</span>(pairs_df, sp_1)</span>
<span id="cb15-13"><a href="#cb15-13"></a>  sp_2 <span class="ot">&lt;-</span> <span class="fu">make_pairs</span>(pairs_df, sp_2)</span>
<span id="cb15-14"><a href="#cb15-14"></a>  </span>
<span id="cb15-15"><a href="#cb15-15"></a>  total_games <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(sp_1, sp_2) <span class="sc">%&gt;%</span></span>
<span id="cb15-16"><a href="#cb15-16"></a>    dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">games =</span> <span class="fu">sum</span>(n),</span>
<span id="cb15-17"><a href="#cb15-17"></a>              <span class="at">.by =</span> <span class="fu">c</span>(sp, ...))</span>
<span id="cb15-18"><a href="#cb15-18"></a>  </span>
<span id="cb15-19"><a href="#cb15-19"></a>  win_games <span class="ot">&lt;-</span> pairs_df <span class="sc">%&gt;%</span></span>
<span id="cb15-20"><a href="#cb15-20"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(transfer <span class="sc">==</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-21"><a href="#cb15-21"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(outcome <span class="sc">==</span> <span class="st">"exclusion"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-22"><a href="#cb15-22"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(sp_1, sp_2, ...) <span class="sc">%&gt;%</span></span>
<span id="cb15-23"><a href="#cb15-23"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">win =</span> <span class="fu">case_when</span>(f_1 <span class="sc">&gt;=</span> f_2 <span class="sc">~</span> sp_1, f_2 <span class="sc">&gt;</span> f_1 <span class="sc">~</span> sp_2)) <span class="sc">%&gt;%</span></span>
<span id="cb15-24"><a href="#cb15-24"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-25"><a href="#cb15-25"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(sp_1, sp_2, win, ...) <span class="sc">%&gt;%</span></span>
<span id="cb15-26"><a href="#cb15-26"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(...) <span class="sc">%&gt;%</span></span>
<span id="cb15-27"><a href="#cb15-27"></a>    dplyr<span class="sc">::</span><span class="fu">count</span>(win, <span class="at">name =</span> <span class="st">"wins"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-28"><a href="#cb15-28"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">sp =</span> win) <span class="sc">%&gt;%</span></span>
<span id="cb15-29"><a href="#cb15-29"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb15-30"><a href="#cb15-30"></a>  </span>
<span id="cb15-31"><a href="#cb15-31"></a>  lose_games <span class="ot">&lt;-</span> pairs_df <span class="sc">%&gt;%</span></span>
<span id="cb15-32"><a href="#cb15-32"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(transfer <span class="sc">==</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-33"><a href="#cb15-33"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(outcome <span class="sc">==</span> <span class="st">"exclusion"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-34"><a href="#cb15-34"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(sp_1, sp_2, ...) <span class="sc">%&gt;%</span></span>
<span id="cb15-35"><a href="#cb15-35"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">loss =</span> <span class="fu">case_when</span>(f_1 <span class="sc">&gt;=</span> f_2 <span class="sc">~</span> sp_2, f_2 <span class="sc">&gt;</span> f_1 <span class="sc">~</span> sp_1)) <span class="sc">%&gt;%</span></span>
<span id="cb15-36"><a href="#cb15-36"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-37"><a href="#cb15-37"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(sp_1, sp_2, loss, ...) <span class="sc">%&gt;%</span></span>
<span id="cb15-38"><a href="#cb15-38"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(...) <span class="sc">%&gt;%</span></span>
<span id="cb15-39"><a href="#cb15-39"></a>    dplyr<span class="sc">::</span><span class="fu">count</span>(loss, <span class="at">name =</span> <span class="st">"losses"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-40"><a href="#cb15-40"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">sp =</span> loss) <span class="sc">%&gt;%</span></span>
<span id="cb15-41"><a href="#cb15-41"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb15-42"><a href="#cb15-42"></a>  </span>
<span id="cb15-43"><a href="#cb15-43"></a><span class="fu">left_join</span>(total_games, win_games, <span class="at">by =</span> <span class="fu">join_by</span>(sp, ...)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-44"><a href="#cb15-44"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(lose_games, <span class="at">by =</span> <span class="fu">join_by</span>(sp, ...)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-45"><a href="#cb15-45"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">replace_na</span>(.x, <span class="dv">0</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb15-46"><a href="#cb15-46"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">score =</span> (wins <span class="sc">-</span> losses)<span class="sc">/</span>games) <span class="sc">%&gt;%</span> </span>
<span id="cb15-47"><a href="#cb15-47"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(...) <span class="sc">%&gt;%</span> </span>
<span id="cb15-48"><a href="#cb15-48"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(..., <span class="fu">desc</span>(score)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-49"><a href="#cb15-49"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">dense_rank</span>(<span class="fu">desc</span>(score)),</span>
<span id="cb15-50"><a href="#cb15-50"></a>         <span class="at">plotrank =</span> <span class="fu">row_number</span>(<span class="fu">desc</span>(score)),</span>
<span id="cb15-51"><a href="#cb15-51"></a>         <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb15-52"><a href="#cb15-52"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-53"><a href="#cb15-53"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">name =</span> sp, ..., rank, plotrank)</span>
<span id="cb15-54"><a href="#cb15-54"></a>}</span>
<span id="cb15-55"><a href="#cb15-55"></a></span>
<span id="cb15-56"><a href="#cb15-56"></a>make_edges <span class="ot">&lt;-</span> <span class="cf">function</span>(pairs_df, ...){</span>
<span id="cb15-57"><a href="#cb15-57"></a>  pairs_df <span class="sc">%&gt;%</span> </span>
<span id="cb15-58"><a href="#cb15-58"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(transfer <span class="sc">==</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-59"><a href="#cb15-59"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">from =</span> <span class="fu">if_else</span>(f_1 <span class="sc">&gt;</span> f_2, sp_1, sp_2),</span>
<span id="cb15-60"><a href="#cb15-60"></a>           <span class="at">to =</span> <span class="fu">if_else</span>(f_1 <span class="sc">&lt;</span> f_2, sp_1, sp_2)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-61"><a href="#cb15-61"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(from, to, ...) <span class="sc">%&gt;%</span> </span>
<span id="cb15-62"><a href="#cb15-62"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">if_else</span>(<span class="fu">sum</span>(type <span class="sc">==</span> <span class="st">"stable"</span>) <span class="sc">==</span> <span class="dv">2</span>, <span class="st">"stable"</span>, <span class="st">"incomplete"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-63"><a href="#cb15-63"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-64"><a href="#cb15-64"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(from, to, ..., outcome, type) <span class="sc">%&gt;%</span> </span>
<span id="cb15-65"><a href="#cb15-65"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-66"><a href="#cb15-66"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(from, to, ...)</span>
<span id="cb15-67"><a href="#cb15-67"></a>}</span>
<span id="cb15-68"><a href="#cb15-68"></a></span>
<span id="cb15-69"><a href="#cb15-69"></a>plot_network_hierarchy <span class="ot">&lt;-</span> <span class="cf">function</span>(net, <span class="at">tune_angle =</span> <span class="dv">1</span>, <span class="at">n_rank =</span> <span class="dv">10</span>, <span class="at">n_break =</span> <span class="dv">10</span>) {</span>
<span id="cb15-70"><a href="#cb15-70"></a>  <span class="co"># code for formatting the positions of the nodes with the ranks was taken from</span></span>
<span id="cb15-71"><a href="#cb15-71"></a>  <span class="co"># here: https://github.com/Chang-Yu-Chang/emergent-coexistence/blob/v2.0.0/plotting_scripts/Fig3.R</span></span>
<span id="cb15-72"><a href="#cb15-72"></a>  </span>
<span id="cb15-73"><a href="#cb15-73"></a>  node_size <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb15-74"><a href="#cb15-74"></a>  edge_width <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb15-75"><a href="#cb15-75"></a></span>
<span id="cb15-76"><a href="#cb15-76"></a>  graph_ranked <span class="ot">&lt;-</span> net <span class="sc">%&gt;%</span></span>
<span id="cb15-77"><a href="#cb15-77"></a>    tidygraph<span class="sc">::</span><span class="fu">activate</span>(nodes) <span class="sc">%&gt;%</span></span>
<span id="cb15-78"><a href="#cb15-78"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(name, rank, plotrank) <span class="sc">%&gt;%</span></span>
<span id="cb15-79"><a href="#cb15-79"></a>    tidygraph<span class="sc">::</span><span class="fu">activate</span>(edges) <span class="sc">%&gt;%</span></span>
<span id="cb15-80"><a href="#cb15-80"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">fromRank =</span> <span class="fu">.N</span>()<span class="sc">$</span>plotrank[<span class="fu">match</span>(from, <span class="fu">.N</span>()<span class="sc">$</span>name)],</span>
<span id="cb15-81"><a href="#cb15-81"></a>           <span class="at">toRank =</span> <span class="fu">.N</span>()<span class="sc">$</span>plotrank[<span class="fu">match</span>(to, <span class="fu">.N</span>()<span class="sc">$</span>name)])</span>
<span id="cb15-82"><a href="#cb15-82"></a></span>
<span id="cb15-83"><a href="#cb15-83"></a>  graph_ranked <span class="ot">&lt;-</span> graph_ranked <span class="sc">%&gt;%</span></span>
<span id="cb15-84"><a href="#cb15-84"></a>    tidygraph<span class="sc">::</span><span class="fu">activate</span>(nodes) <span class="sc">%&gt;%</span></span>
<span id="cb15-85"><a href="#cb15-85"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">y =</span> <span class="sc">-</span>rank) <span class="sc">%&gt;%</span></span>
<span id="cb15-86"><a href="#cb15-86"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(rank) <span class="sc">%&gt;%</span></span>
<span id="cb15-87"><a href="#cb15-87"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">x =</span> {<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="fu">n</span>() <span class="sc">+</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="st">`</span><span class="at">[</span><span class="st">`</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="fu">length</span>(.)))}) <span class="sc">%&gt;%</span></span>
<span id="cb15-88"><a href="#cb15-88"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-89"><a href="#cb15-89"></a>    tidygraph<span class="sc">::</span><span class="fu">activate</span>(edges) <span class="sc">%&gt;%</span></span>
<span id="cb15-90"><a href="#cb15-90"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(outcome, <span class="st">"inconclusive"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-91"><a href="#cb15-91"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(outcome)</span>
<span id="cb15-92"><a href="#cb15-92"></a></span>
<span id="cb15-93"><a href="#cb15-93"></a>  <span class="fu">ggraph</span>(graph_ranked, <span class="at">layout =</span> <span class="st">"nicely"</span>) <span class="sc">+</span></span>
<span id="cb15-94"><a href="#cb15-94"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span>n_rank<span class="sc">:-</span><span class="dv">1</span>), <span class="at">color =</span> <span class="st">"grey90"</span>) <span class="sc">+</span></span>
<span id="cb15-95"><a href="#cb15-95"></a>    <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">repel =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb15-96"><a href="#cb15-96"></a>    <span class="fu">geom_node_point</span>(<span class="at">size =</span> node_size, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"grey"</span>, <span class="at">stroke =</span> node_size<span class="sc">/</span><span class="dv">5</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb15-97"><a href="#cb15-97"></a>    <span class="fu">geom_edge_diagonal</span>(<span class="fu">aes</span>(<span class="at">color =</span> outcome, <span class="at">linetype =</span> type),</span>
<span id="cb15-98"><a href="#cb15-98"></a>                       <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"mm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>, <span class="at">angle =</span> <span class="dv">30</span>, <span class="at">ends =</span> <span class="st">"last"</span>),</span>
<span id="cb15-99"><a href="#cb15-99"></a>                       <span class="at">start_cap =</span> <span class="fu">circle</span>(node_size<span class="sc">*</span>.<span class="dv">8</span>, <span class="st">"mm"</span>),</span>
<span id="cb15-100"><a href="#cb15-100"></a>                       <span class="at">end_cap =</span> <span class="fu">circle</span>(node_size<span class="sc">*</span><span class="fl">0.8</span>, <span class="st">"mm"</span>)) <span class="sc">+</span></span>
<span id="cb15-101"><a href="#cb15-101"></a>    <span class="fu">scale_edge_color_manual</span>(<span class="at">values =</span> outcome_pal) <span class="sc">+</span></span>
<span id="cb15-102"><a href="#cb15-102"></a>    <span class="fu">scale_edge_linetype_manual</span>(<span class="at">values =</span> type_pal) <span class="sc">+</span></span>
<span id="cb15-103"><a href="#cb15-103"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb15-104"><a href="#cb15-104"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>n_break<span class="dv">-1</span>, <span class="dv">0</span>), <span class="at">breaks =</span> <span class="sc">-</span>n_break<span class="sc">:-</span><span class="dv">1</span>, <span class="at">labels =</span> n_break<span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-105"><a href="#cb15-105"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb15-106"><a href="#cb15-106"></a>    <span class="fu">theme</span>(</span>
<span id="cb15-107"><a href="#cb15-107"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-108"><a href="#cb15-108"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-109"><a href="#cb15-109"></a>        <span class="at">strip.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-110"><a href="#cb15-110"></a>        <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="st">"mm"</span>)</span>
<span id="cb15-111"><a href="#cb15-111"></a>    )</span>
<span id="cb15-112"><a href="#cb15-112"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evolution-and-streptomycin-categories-separate" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="evolution-and-streptomycin-categories-separate"><span class="header-section-number">6.2</span> Evolution and Streptomycin categories separate</h2>
<p>Here we plot a separate graph for each streptomycin concentrations and also by different evolutionary groupings. For example, there is one graph for the competition outcomes of only ancestral species, there is one graph of the outcomes of only evolved species, and there is one graph for the outcomes of mixed competitions where an ancestral species competes against an evolved species.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>nodes1 <span class="ot">&lt;-</span> <span class="fu">make_nodes</span>(samp_pairs_fmt, strep_conc, evo_group)</span>
<span id="cb16-2"><a href="#cb16-2"></a>edges1 <span class="ot">&lt;-</span> <span class="fu">make_edges</span>(samp_pairs_fmt, strep_conc, evo_group)</span>
<span id="cb16-3"><a href="#cb16-3"></a></span>
<span id="cb16-4"><a href="#cb16-4"></a>graphs1 <span class="ot">&lt;-</span> <span class="fu">nest</span>(nodes1, <span class="at">sps =</span> <span class="sc">-</span><span class="fu">c</span>(strep_conc, evo_group)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="fu">left_join</span>(<span class="fu">nest</span>(edges1, <span class="at">pairs =</span> <span class="sc">-</span><span class="fu">c</span>(strep_conc, evo_group)),</span>
<span id="cb16-6"><a href="#cb16-6"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(strep_conc, evo_group)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-7"><a href="#cb16-7"></a>  <span class="fu">mutate</span>(<span class="at">network =</span> <span class="fu">map2</span>(sps, pairs, <span class="cf">function</span>(sps, pairs) <span class="fu">tbl_graph</span>(<span class="at">nodes =</span> sps, <span class="at">edges =</span> pairs, <span class="at">directed =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb16-8"><a href="#cb16-8"></a>  <span class="fu">mutate</span>(<span class="at">plot =</span> <span class="fu">map</span>(network, <span class="cf">function</span>(network) <span class="fu">plot_network_hierarchy</span>(network, <span class="at">tune_angle =</span> <span class="fl">1.5</span>, <span class="at">n_rank =</span> <span class="dv">7</span>, <span class="at">n_break =</span> <span class="dv">7</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-03" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(graphs1[[<span class="dv">6</span>]], <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">guides=</span> <span class="st">"collect"</span>) <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>  patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_pairs_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Competitive hierarchy of species pairs separated by evolution grouping (only ancestral pairs, only evolved pairs, and mixed ancestral and evolved pairs) and streptomycin concentration. Subplots A-D are for only ancestral pairs, E-H for only evolved pairs, and I-L for mixed ancestral and evolved pairs. Subplots A, E, I show experiments under no streptomycin, B, F, J 16 µg/ml streptomycin, C, G, K for 64 µg/ml streptomycin, and D, H, L for 256 µg/ml streptomycin. For each evolution/streptomycin grouping, strains are rank ordered on the basis of the number of other strains they exclude, based on data shown in <a href="#fig-01" class="quarto-xref">Figure&nbsp;1</a> and <a href="#fig-02" class="quarto-xref">Figure&nbsp;2</a>. Grey nodes represent strains (denoted by text), red arrows point from winning strain to losing strain, blue arrows indicate coexistence (ignore the arrow heads for blue, coulnd’t figure out how to remove them for only a subset of the edges), and green arrows indicate the presence of bistability (i.e., Species A and Species B exclude each other when invading from high abundance, and each are excluded by the other when invading from low abundance). Line type indicates the degree of certainty of the outcome in each pair: dashed lines represent incomplete exclusion or coexistence without evidence of mutual invasibility, while solid lines indicate complete exclusion or stable coexistence (mutual invasibility).
</figcaption>
</figure>
</div>
</section>
<section id="only-streptomycin-category-separate" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="only-streptomycin-category-separate"><span class="header-section-number">6.3</span> Only Streptomycin category separate</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>nodes2 <span class="ot">&lt;-</span> <span class="fu">make_nodes</span>(samp_pairs_fmt, strep_conc)</span>
<span id="cb18-2"><a href="#cb18-2"></a>edges2 <span class="ot">&lt;-</span> <span class="fu">make_edges</span>(samp_pairs_fmt, strep_conc)</span>
<span id="cb18-3"><a href="#cb18-3"></a></span>
<span id="cb18-4"><a href="#cb18-4"></a>graphs2 <span class="ot">&lt;-</span> <span class="fu">nest</span>(nodes2, <span class="at">sps =</span> <span class="sc">-</span><span class="fu">c</span>(strep_conc)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="fu">left_join</span>(<span class="fu">nest</span>(edges2, <span class="at">pairs =</span> <span class="sc">-</span><span class="fu">c</span>(strep_conc)),</span>
<span id="cb18-6"><a href="#cb18-6"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(strep_conc)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="fu">mutate</span>(<span class="at">network =</span> <span class="fu">map2</span>(sps, pairs, <span class="cf">function</span>(sps, pairs) <span class="fu">tbl_graph</span>(<span class="at">nodes =</span> sps, <span class="at">edges =</span> pairs, <span class="at">directed =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb18-8"><a href="#cb18-8"></a>  <span class="fu">mutate</span>(<span class="at">plot =</span> <span class="fu">map</span>(network, <span class="cf">function</span>(network) <span class="fu">plot_network_hierarchy</span>(network, <span class="at">tune_angle =</span> <span class="fl">1.5</span>, <span class="at">n_rank =</span> <span class="dv">7</span>, <span class="at">n_break =</span> <span class="dv">7</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-04" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-04-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(graphs2[[<span class="dv">5</span>]], <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">guides=</span> <span class="st">"collect"</span>) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_pairs_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-04-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Competitive hierarchy of species pairs separated by streptomycin concentration. Subplot A shows experiments under no streptomycin, B with 16 µg/ml streptomycin, C with 64 µg/ml streptomycin, and D with 256 µg/ml streptomycin. For each evolution/streptomycin grouping, strains are rank ordered on the basis of the number of other strains they exclude, based on data shown in <a href="#fig-01" class="quarto-xref">Figure&nbsp;1</a> and <a href="#fig-02" class="quarto-xref">Figure&nbsp;2</a>. Grey nodes represent strains (denoted by text), red arrows point from winning strain to losing strain, blue arrows indicate coexistence (ignore the arrow heads for blue, coulnd’t figure out how to remove them for only a subset of the edges), and green arrows indicate the presence of bistability (i.e., Species A and Species B exclude each other when invading from high abundance, and each are excluded by the other when invading from low abundance). Line type indicates the degree of certainty of the outcome in each pair: dashed lines represent incomplete exclusion or coexistence without evidence of mutual invasibility, while solid lines indicate complete exclusion or stable coexistence (mutual invasibility).
</figcaption>
</figure>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>