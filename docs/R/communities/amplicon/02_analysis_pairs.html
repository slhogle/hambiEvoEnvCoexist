<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shane Hogle">
<meta name="dcterms.date" content="2025-05-24">

<title>Analysis of pairwise competition – hambiEvoEnvCoexist</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-1f23bf93a17969024013c136d185e5ce.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../R/communities/amplicon/02_analysis_pairs.html">5. Community growth - Coexistence/exclusion analysis</a></li><li class="breadcrumb-item"><a href="../../../R/communities/amplicon/02_analysis_pairs.html">i) Species pairs</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../../">hambiEvoEnvCoexist</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">1. Monoculture growth</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../R/monocultures/bioscreen/01_format_growthcurves_batch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">i) Inspect and format growth curves</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../R/monocultures/bioscreen/02_plot_analyze_growth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ii) Plot growth summaries</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">2. Community growth - experiment design</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../R/communities/experiment_design/01_pairs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">i) Species pairs - 96 Well plate layout</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../R/communities/experiment_design/02_trios.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ii) Species trios - 96 Well plate layout</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../R/communities/experiment_design/03_quartets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">iii) Species quartets - 96 Well plate layout</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">3. Community growth - optical density</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../R/communities/optical_density/01_format_plot_od.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">i) Process and plot OD data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">4. Community growth - amplicon formatting</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../R/communities/amplicon/20240711_BTK_illumina_v3/01_format_rbec_tab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">i) Batch 2024-07-11</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../R/communities/amplicon/20240711_BTK_illumina_v3/02_correct_boil_to_qiagen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ii) Batch 2024-07-11 calibration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../R/communities/amplicon/20241024_BTK_illumina_v3/01_format_rbec_tab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">iii) Batch 2024-10-24</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../R/communities/amplicon/20250127_BTK_illumina_v3/01_format_rbec_tab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">iv) Batch 2025-01-27</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../R/communities/amplicon/20250502_BTK_illumina_v3/01_format_rbec_tab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">v) Batch 2025-05-02</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../R/communities/amplicon/01_compile_format.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">vi) Compile pairs, trios, quartets</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">5. Community growth - Coexistence/exclusion analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../R/communities/amplicon/02_analysis_pairs.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">i) Species pairs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../R/communities/amplicon/03_analysis_trios.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ii) Species trios</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../R/communities/amplicon/04_analysis_quartets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">iii) Species quartets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../R/communities/amplicon/05_analysis_octets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">iv) All strains combined</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup"><span class="header-section-number">2</span> Setup</a>
  <ul class="collapse">
  <li><a href="#libraries" id="toc-libraries" class="nav-link" data-scroll-target="#libraries"><span class="header-section-number">2.1</span> Libraries</a></li>
  <li><a href="#global-variables" id="toc-global-variables" class="nav-link" data-scroll-target="#global-variables"><span class="header-section-number">2.2</span> Global variables</a></li>
  </ul></li>
  <li><a href="#read-data" id="toc-read-data" class="nav-link" data-scroll-target="#read-data"><span class="header-section-number">3</span> Read data</a>
  <ul class="collapse">
  <li><a href="#species-abundances" id="toc-species-abundances" class="nav-link" data-scroll-target="#species-abundances"><span class="header-section-number">3.1</span> Species abundances</a></li>
  </ul></li>
  <li><a href="#formatting" id="toc-formatting" class="nav-link" data-scroll-target="#formatting"><span class="header-section-number">4</span> Formatting</a>
  <ul class="collapse">
  <li><a href="#transfer-0-starting-proportions" id="toc-transfer-0-starting-proportions" class="nav-link" data-scroll-target="#transfer-0-starting-proportions"><span class="header-section-number">4.1</span> Transfer 0 (starting proportions)</a></li>
  <li><a href="#transfer-8-ending-proportions" id="toc-transfer-8-ending-proportions" class="nav-link" data-scroll-target="#transfer-8-ending-proportions"><span class="header-section-number">4.2</span> Transfer 8 (ending proportions)</a></li>
  </ul></li>
  <li><a href="#define-competition-outcomes" id="toc-define-competition-outcomes" class="nav-link" data-scroll-target="#define-competition-outcomes"><span class="header-section-number">5</span> Define competition outcomes</a>
  <ul class="collapse">
  <li><a href="#binomial-sampling-and-wilcox-test" id="toc-binomial-sampling-and-wilcox-test" class="nav-link" data-scroll-target="#binomial-sampling-and-wilcox-test"><span class="header-section-number">5.1</span> Binomial sampling and Wilcox test</a></li>
  <li><a href="#competition-outcome-rules" id="toc-competition-outcome-rules" class="nav-link" data-scroll-target="#competition-outcome-rules"><span class="header-section-number">5.2</span> Competition outcome rules</a>
  <ul class="collapse">
  <li><a href="#exclusion" id="toc-exclusion" class="nav-link" data-scroll-target="#exclusion"><span class="header-section-number">5.2.1</span> Exclusion</a></li>
  <li><a href="#towards-exclusion" id="toc-towards-exclusion" class="nav-link" data-scroll-target="#towards-exclusion"><span class="header-section-number">5.2.2</span> Towards Exclusion</a></li>
  <li><a href="#stable-coexistence" id="toc-stable-coexistence" class="nav-link" data-scroll-target="#stable-coexistence"><span class="header-section-number">5.2.3</span> Stable Coexistence</a></li>
  <li><a href="#coexistence-without-evidence-for-mutual-invasion" id="toc-coexistence-without-evidence-for-mutual-invasion" class="nav-link" data-scroll-target="#coexistence-without-evidence-for-mutual-invasion"><span class="header-section-number">5.2.4</span> Coexistence without evidence for mutual invasion</a></li>
  <li><a href="#inconclusive" id="toc-inconclusive" class="nav-link" data-scroll-target="#inconclusive"><span class="header-section-number">5.2.5</span> Inconclusive</a></li>
  </ul></li>
  <li><a href="#plotting-pairwise-outpcomes" id="toc-plotting-pairwise-outpcomes" class="nav-link" data-scroll-target="#plotting-pairwise-outpcomes"><span class="header-section-number">5.3</span> Plotting pairwise outpcomes</a></li>
  </ul></li>
  <li><a href="#network" id="toc-network" class="nav-link" data-scroll-target="#network"><span class="header-section-number">6</span> Network</a>
  <ul class="collapse">
  <li><a href="#evolution-and-streptomycin-categories-separate" id="toc-evolution-and-streptomycin-categories-separate" class="nav-link" data-scroll-target="#evolution-and-streptomycin-categories-separate"><span class="header-section-number">6.1</span> Evolution and Streptomycin categories separate</a></li>
  <li><a href="#only-streptomycin-category-separate" id="toc-only-streptomycin-category-separate" class="nav-link" data-scroll-target="#only-streptomycin-category-separate"><span class="header-section-number">6.2</span> Only Streptomycin category separate</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../R/communities/amplicon/02_analysis_pairs.html">5. Community growth - Coexistence/exclusion analysis</a></li><li class="breadcrumb-item"><a href="../../../R/communities/amplicon/02_analysis_pairs.html">i) Species pairs</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Analysis of pairwise competition</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Shane Hogle </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 24, 2025</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    Here we analyze the community outpcomes from all competing species pairs.
  </div>
</div>


</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Contains results from pairs of all streptomycin concentrations and trios for 0 streptomycin</p>
</section>
<section id="setup" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Setup</h1>
<section id="libraries" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="libraries"><span class="header-section-number">2.1</span> Libraries</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(here)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(fs)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">library</span>(ggraph)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">library</span>(tidygraph)</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"utils_generic.R"</span>))</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"communities"</span>, <span class="st">"amplicon"</span>, <span class="st">"utils_amplicon.R"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="global-variables" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="global-variables"><span class="header-section-number">2.2</span> Global variables</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>data <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"communities"</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co"># make processed data directory if it doesn't exist</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>fs<span class="sc">::</span><span class="fu">dir_create</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="read-data" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Read data</h1>
<section id="species-abundances" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="species-abundances"><span class="header-section-number">3.1</span> Species abundances</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>samp_pairs_9010 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(here<span class="sc">::</span><span class="fu">here</span>(data, <span class="st">"2sps_compiled_9010.tsv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">f =</span> f_thresh)</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a>samp_pairs_5050 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(here<span class="sc">::</span><span class="fu">here</span>(data, <span class="st">"2sps_compiled_5050.tsv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">f =</span> f_thresh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="formatting" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Formatting</h1>
<section id="transfer-0-starting-proportions" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="transfer-0-starting-proportions"><span class="header-section-number">4.1</span> Transfer 0 (starting proportions)</h2>
<p>First get abundances from transfer 0 (masterplate)</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>format_master <span class="ot">&lt;-</span> <span class="cf">function</span>(.data){</span>
<span id="cb4-2"><a href="#cb4-2"></a>  .data <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3"></a>      <span class="co"># make a combined evolution and species identifier and extract the community ID</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sp =</span> <span class="fu">paste</span>(<span class="fu">str_to_upper</span>(evo_hist), <span class="fu">str_extract</span>(strainID, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>), <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb4-5"><a href="#cb4-5"></a>         <span class="at">community_id =</span> <span class="fu">str_extract</span>(sample, <span class="st">"P</span><span class="sc">\\</span><span class="st">d</span><span class="sc">\\</span><span class="st">d"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="co"># this step is important to ensure that when dfs are pivoted wider the </span></span>
<span id="cb4-7"><a href="#cb4-7"></a>  <span class="co"># sp_1 and sp_2 stay consistent </span></span>
<span id="cb4-8"><a href="#cb4-8"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(community_id, sp) <span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>  <span class="co"># this creates an index for each species present in each community, it is needed</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>  <span class="co"># for the pivot to be consistent between the master plate and the samples</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(community_id) <span class="sc">%&gt;%</span> </span>
<span id="cb4-12"><a href="#cb4-12"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb4-13"><a href="#cb4-13"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-14"><a href="#cb4-14"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> community_id, <span class="at">values_from =</span> <span class="fu">c</span>(sp, f), <span class="at">names_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb4-15"><a href="#cb4-15"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">transfer =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-16"><a href="#cb4-16"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">strep_conc =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">16</span>, <span class="dv">64</span>, <span class="dv">256</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-17"><a href="#cb4-17"></a>  <span class="fu">arrange</span>(sp_1, sp_2, strep_conc) <span class="sc">%&gt;%</span> </span>
<span id="cb4-18"><a href="#cb4-18"></a>  <span class="fu">arrange</span>(community_id)</span>
<span id="cb4-19"><a href="#cb4-19"></a>}  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>samp_pairs_fmt_mp_9010 <span class="ot">&lt;-</span> samp_pairs_9010 <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(community_type, <span class="st">"master"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">format_master</span>()</span>
<span id="cb5-4"><a href="#cb5-4"></a>  </span>
<span id="cb5-5"><a href="#cb5-5"></a>samp_pairs_fmt_mp_5050 <span class="ot">&lt;-</span> samp_pairs_5050 <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="#cb5-6"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(community_type, <span class="st">"master"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>  <span class="fu">format_master</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8"></a>  <span class="fu">mutate</span>(<span class="at">community_id =</span> <span class="fu">paste0</span>(<span class="st">"P"</span>, <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(community_id, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>))<span class="sc">+</span><span class="dv">48</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="transfer-8-ending-proportions" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="transfer-8-ending-proportions"><span class="header-section-number">4.2</span> Transfer 8 (ending proportions)</h2>
<p>Format abundances from the experiment, summarizing over replicates. Here we calculate the median frequency across biological replicates using <code>Hmisc::smedian.hilow</code> which computes the sample median and the outer quantiles (0.025 and 0.975).</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>samp_pairs_fmt_exp_9010 <span class="ot">&lt;-</span> samp_pairs_9010 <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(community_type <span class="sc">==</span> <span class="st">"experiment"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="co"># make a combined evolution and species identifier and extract the community ID</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sp =</span> <span class="fu">paste</span>(<span class="fu">str_to_upper</span>(evo_hist), <span class="fu">str_extract</span>(strainID, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>), <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb6-5"><a href="#cb6-5"></a>         <span class="at">community_id =</span> <span class="fu">str_extract</span>(sample, <span class="st">"P</span><span class="sc">\\</span><span class="st">d</span><span class="sc">\\</span><span class="st">d"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="co"># calculate median and 95% CI across replicates</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(ggplot2<span class="sc">::</span><span class="fu">median_hilow</span>(f), <span class="at">.by =</span> <span class="fu">c</span>(<span class="st">"community_id"</span>, <span class="st">"sp"</span>, <span class="st">"strep_conc"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="co"># rename the y columns as f for compatibility</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">"y"</span>), \(x) <span class="fu">str_replace</span>(x, <span class="st">"y"</span>, <span class="st">"f"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="#cb6-10"></a>  <span class="co"># this step is important to ensure that when dfs are pivoted wider the </span></span>
<span id="cb6-11"><a href="#cb6-11"></a>  <span class="co"># sp_1 and sp_2 stay consistent </span></span>
<span id="cb6-12"><a href="#cb6-12"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(community_id, sp, strep_conc) <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>  <span class="co"># this creates an index for each species present in each community, it is needed</span></span>
<span id="cb6-14"><a href="#cb6-14"></a>  <span class="co"># for the pivot to be consistent between the master plate and the samples</span></span>
<span id="cb6-15"><a href="#cb6-15"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(community_id, strep_conc) <span class="sc">%&gt;%</span> </span>
<span id="cb6-16"><a href="#cb6-16"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb6-17"><a href="#cb6-17"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-18"><a href="#cb6-18"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(community_id, strep_conc), <span class="at">values_from =</span> <span class="fu">c</span>(sp, f, fmin, fmax), <span class="at">names_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb6-19"><a href="#cb6-19"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">transfer =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-20"><a href="#cb6-20"></a>  <span class="fu">arrange</span>(sp_1, sp_2, strep_conc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>samp_pairs_fmt_exp_5050 <span class="ot">&lt;-</span> samp_pairs_5050 <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(community_type <span class="sc">==</span> <span class="st">"experiment"</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="co"># make a combined evolution and species identifier and extract the community ID</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sp =</span> <span class="fu">paste</span>(<span class="fu">str_to_upper</span>(evo_hist), <span class="fu">str_extract</span>(strainID, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>), <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb7-5"><a href="#cb7-5"></a>         <span class="at">community_id =</span> <span class="fu">str_extract</span>(sample, <span class="st">"P</span><span class="sc">\\</span><span class="st">d</span><span class="sc">\\</span><span class="st">d"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="fu">arrange</span>(community_id, strep_conc) <span class="sc">%&gt;%</span> </span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="co"># there is only one replicate so we can't calculate median/mean</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(community_id, sp, strep_conc) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="co"># this creates an index for each species present in each community, it is needed</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>  <span class="co"># for the pivot to be consistent between the master plate and the samples</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(community_id, strep_conc) <span class="sc">%&gt;%</span> </span>
<span id="cb7-12"><a href="#cb7-12"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb7-13"><a href="#cb7-13"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-14"><a href="#cb7-14"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(community_id, strep_conc), <span class="at">values_from =</span> <span class="fu">c</span>(sp, f), <span class="at">names_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb7-15"><a href="#cb7-15"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">transfer =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-16"><a href="#cb7-16"></a>  <span class="fu">arrange</span>(sp_1, sp_2, strep_conc) <span class="sc">%&gt;%</span> </span>
<span id="cb7-17"><a href="#cb7-17"></a>  <span class="fu">arrange</span>(community_id) <span class="sc">%&gt;%</span> </span>
<span id="cb7-18"><a href="#cb7-18"></a>  <span class="fu">mutate</span>(<span class="at">community_id =</span> <span class="fu">paste0</span>(<span class="st">"P"</span>, <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(community_id, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>))<span class="sc">+</span><span class="dv">48</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="define-competition-outcomes" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Define competition outcomes</h1>
<section id="binomial-sampling-and-wilcox-test" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="binomial-sampling-and-wilcox-test"><span class="header-section-number">5.1</span> Binomial sampling and Wilcox test</h2>
<p>First need to determine which samples significantly decreased/increased from T0 to T8. We don’t have enough biological replicates for to compute a statistic across replicates for <a href="https://www.pnas.org/doi/10.1073/pnas.2302491120">outcome variability</a>. However, we can estimate the mean fraction of A and quantify the inferential uncertainty of the mean by bootstrap resampling. We the used median proportion of species A from two biological replicates of each T8 pair as the probability of success (i.e., drawing species A) from 1000 draws (i.e., sequencing reads) from the binomial distribution. To determine whether the frequency of Species A significantly changed from T0 to T8, the means of the 1000 binomial draws for T0 and T8 were compared using a Wilcoxon rank sum test (N = 2000). Tests with Bonferroni multiple test corrected p values &lt; 1e-5 were considered to represent significantly different T0 and T8 samples.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>wc_test <span class="ot">&lt;-</span> <span class="cf">function</span>(df1, df2){</span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="co"># first join the T0 and T8 abundances</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">left_join</span>(df1, df2, <span class="at">by =</span> <span class="fu">join_by</span>(community_id, strep_conc, sp_1, sp_2)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">delta_f_1 =</span> f_1.x <span class="sc">-</span> f_1.y) <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="#cb8-5"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(community_id, strep_conc, sp_1, sp_2, delta_f_1, <span class="at">f_1_8 =</span> f_1.x, <span class="at">f_1_0 =</span> f_1.y, </span>
<span id="cb8-6"><a href="#cb8-6"></a>                <span class="at">f_2_8 =</span> f_2.x, <span class="at">f_2_0 =</span> f_2.y) <span class="sc">%&gt;%</span> </span>
<span id="cb8-7"><a href="#cb8-7"></a>  tidyr<span class="sc">::</span><span class="fu">nest</span>(<span class="at">data =</span> <span class="fu">c</span>(<span class="sc">-</span>community_id, <span class="sc">-</span>strep_conc)) <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>  <span class="co"># samples 1000 draws from binomial distribution using f_a median as the probability of success</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">f_1_0_rs =</span> purrr<span class="sc">::</span><span class="fu">map</span>(data, \(x) <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, \(i) <span class="fu">sum</span>(<span class="fu">rbinom</span>(<span class="dv">1000</span>, <span class="dv">1</span>, x<span class="sc">$</span>f_1_0))<span class="sc">/</span><span class="dv">1000</span>)),</span>
<span id="cb8-10"><a href="#cb8-10"></a>         <span class="at">f_1_8_rs =</span> purrr<span class="sc">::</span><span class="fu">map</span>(data, \(x) <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, \(i) <span class="fu">sum</span>(<span class="fu">rbinom</span>(<span class="dv">1000</span>, <span class="dv">1</span>, x<span class="sc">$</span>f_1_8))<span class="sc">/</span><span class="dv">1000</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb8-11"><a href="#cb8-11"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(data, f_1_0_rs, f_1_8_rs)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-12"><a href="#cb8-12"></a>  <span class="co"># nest the samples</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>  tidyr<span class="sc">::</span><span class="fu">nest</span>(<span class="at">bs =</span> <span class="fu">c</span>(f_1_0_rs, f_1_8_rs)) <span class="sc">%&gt;%</span></span>
<span id="cb8-14"><a href="#cb8-14"></a>  <span class="co"># perform the wilcox test</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">wc =</span> purrr<span class="sc">::</span><span class="fu">map</span>(bs, \(i) <span class="fu">wilcox.test</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(i<span class="sc">$</span>f_1_0_rs), <span class="at">y =</span> <span class="fu">as.numeric</span>(i<span class="sc">$</span>f_1_8_rs)))) <span class="sc">%&gt;%</span> </span>
<span id="cb8-16"><a href="#cb8-16"></a>  <span class="co"># tidy-ify the test output</span></span>
<span id="cb8-17"><a href="#cb8-17"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">tidy_wc =</span> purrr<span class="sc">::</span><span class="fu">map</span>(wc, \(x) broom<span class="sc">::</span><span class="fu">tidy</span>(x))) <span class="sc">%&gt;%</span> </span>
<span id="cb8-18"><a href="#cb8-18"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(tidy_wc)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-19"><a href="#cb8-19"></a>  <span class="co"># p-value adjust using bonferroni correction</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">p_adjusted =</span> <span class="fu">p.adjust</span>(p.value, <span class="at">method =</span> <span class="st">"bonferroni"</span>, <span class="at">n =</span> <span class="fu">n</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb8-21"><a href="#cb8-21"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(strep_conc, sp_1, sp_2) <span class="sc">%&gt;%</span> </span>
<span id="cb8-22"><a href="#cb8-22"></a>  <span class="co"># define whether change is significantly positive or negative</span></span>
<span id="cb8-23"><a href="#cb8-23"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">change =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(p.value <span class="sc">&gt;</span> <span class="fl">1e-5</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb8-24"><a href="#cb8-24"></a>                             <span class="fu">sign</span>(delta_f_1) <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">&amp;</span> p.value <span class="sc">&lt;=</span> <span class="fl">1e-5</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb8-25"><a href="#cb8-25"></a>                             <span class="fu">sign</span>(delta_f_1) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> p.value <span class="sc">&lt;=</span> <span class="fl">1e-5</span> <span class="sc">~</span> <span class="dv">1</span>)) </span>
<span id="cb8-26"><a href="#cb8-26"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>run the tests</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">set.seed</span>(<span class="dv">124341</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a>wc_test_9010 <span class="ot">&lt;-</span> <span class="fu">wc_test</span>(samp_pairs_fmt_exp_9010, samp_pairs_fmt_mp_9010)</span>
<span id="cb9-4"><a href="#cb9-4"></a>wc_test_5050 <span class="ot">&lt;-</span> <span class="fu">wc_test</span>(samp_pairs_fmt_exp_5050, samp_pairs_fmt_mp_5050)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="competition-outcome-rules" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="competition-outcome-rules"><span class="header-section-number">5.2</span> Competition outcome rules</h2>
<p>Here we set up the rules for defining the competition outcomes. In the pairwise competition experiments each species and evolutionary form was competed against all other species and evolutionary forms (excluding evolutionary forms of the same species because these cannot be resolved using amplicon data). Each competitor in a pair <span class="math inline">\(\{A, B\}\)</span> was allowed to invade from rare (<span class="math inline">\(f^{R} = 0.1\)</span>) while the other competitor was common (<span class="math inline">\(f^{C} = 0.9\)</span>) in duplicate for 8 growth cycles. Additionally we completed one experiment where each strain in the pair was started at roughly equal density. This resulted in 6 experiments for each competing pair. Using the abundance outcomes from both replicates of each the pairwise competition experiments for each pair we classified outcomes as “exclusion”, “towards exclusion”, “stable coexistence”, “coexistence without evidence for mutual invasion”, or “inconclusive” according to the following criteria (also see: https://www.science.org/doi/10.1126/science.adg0727)</p>
<section id="exclusion" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="exclusion"><span class="header-section-number">5.2.1</span> Exclusion</h3>
<p>Requires one species (<span class="math inline">\(A\)</span>) in a pair to be excluded (<span class="math inline">\(f_{A} = 0\)</span>) in all 6 experiments for the species pair.</p>
</section>
<section id="towards-exclusion" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="towards-exclusion"><span class="header-section-number">5.2.2</span> Towards Exclusion</h3>
<p>Relaxes the condition that (<span class="math inline">\(f_{A} = 0\)</span>), but requires one species in a pair to have a significant decrease (<span class="math inline">\(\Delta f_{8-0} &lt; 0\)</span>) (Wilcoxon Test) in all 6 experiments for the species pair.</p>
</section>
<section id="stable-coexistence" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="stable-coexistence"><span class="header-section-number">5.2.3</span> Stable Coexistence</h3>
<p>Both species <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> can stably coexist if each species can invade the other from low frequency <span class="math inline">\(A_{f_{A} &lt; f_{B}} \rightarrow B \vee B_{f_{B} &lt; f_{A}} \rightarrow A\)</span>. Assignment of stable coexistence was made by comparing <span class="math inline">\(sgn(\Delta f_{8-0}) = sgn(\bar{f_{8}} - f_{0})\)</span> where <span class="math inline">\(\bar{f_{8}}\)</span> is the mean frequency of the species at the final sampling timepoint across all 6 experiments.</p>
</section>
<section id="coexistence-without-evidence-for-mutual-invasion" class="level3" data-number="5.2.4">
<h3 data-number="5.2.4" class="anchored" data-anchor-id="coexistence-without-evidence-for-mutual-invasion"><span class="header-section-number">5.2.4</span> Coexistence without evidence for mutual invasion</h3>
<p>This outcome was assigned when each species had a non-zero frequency <span class="math inline">\(f_{A|B} &gt; 0\)</span> in all 6 experiments at the final time point.</p>
</section>
<section id="inconclusive" class="level3" data-number="5.2.5">
<h3 data-number="5.2.5" class="anchored" data-anchor-id="inconclusive"><span class="header-section-number">5.2.5</span> Inconclusive</h3>
<p>This outcome was assigned when none of the above conditions were met.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>outcomes_classified <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(wc_test_9010, wc_test_5050) <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">arrange</span>(sp_1, sp_2, strep_conc) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="fu">group_by</span>(sp_1, sp_2, strep_conc) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="fu">mutate</span>(<span class="at">outcome =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-5"><a href="#cb10-5"></a>    <span class="co"># condition 1</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>    <span class="fu">sum</span>(f_1_8 <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">==</span> <span class="fu">n</span>() <span class="sc">|</span> <span class="fu">sum</span>(f_1_8 <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">==</span> <span class="fu">n</span>() <span class="sc">~</span> <span class="st">"exclusion"</span>,</span>
<span id="cb10-7"><a href="#cb10-7"></a>    <span class="co"># condition 2</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>    <span class="fu">sum</span>(change) <span class="sc">==</span> <span class="fu">n</span>() <span class="sc">|</span> <span class="fu">sum</span>(change) <span class="sc">==</span> <span class="sc">-</span><span class="fu">n</span>() <span class="sc">~</span> <span class="st">"towards exclusion"</span>,</span>
<span id="cb10-9"><a href="#cb10-9"></a>    <span class="co"># condition 3</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>    <span class="fu">sum</span>(<span class="fu">sign</span>(f_1_8 <span class="sc">-</span> f_1_0) <span class="sc">==</span> <span class="fu">sign</span>(<span class="fu">mean</span>(f_1_8)<span class="sc">-</span>f_1_0)) <span class="sc">==</span> <span class="fu">n</span>() <span class="sc">~</span> <span class="st">"stable coexistence"</span>,</span>
<span id="cb10-11"><a href="#cb10-11"></a>    <span class="co"># condition 4</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>    <span class="fu">sum</span>(f_1_8 <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">==</span> <span class="fu">n</span>() <span class="sc">~</span> <span class="st">"coexistence no mutual invasion"</span>,</span>
<span id="cb10-13"><a href="#cb10-13"></a>    <span class="co"># all others are inconclusive</span></span>
<span id="cb10-14"><a href="#cb10-14"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"inconclusive"</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb10-16"><a href="#cb10-16"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>EVO_1287 and EVO_1977 at 256 ug/ml streptomycin technically fullfill the requirements for the outcome “towards exclusion.” However, the patterns at 64 and 16 ug/ml suggest that it could also be “coexistence no mutual invasion.” Assigning coexistence no mutual invasion would break an intransitive loop apparent in the pairs network.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>outcomes_classified <span class="ot">&lt;-</span> outcomes_classified <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="fu">mutate</span>(<span class="at">outcome =</span> <span class="fu">if_else</span>(sp_1 <span class="sc">==</span> <span class="st">"EVO_1287"</span> <span class="sc">&amp;</span> sp_2 <span class="sc">==</span> <span class="st">"EVO_1977"</span> <span class="sc">&amp;</span> strep_conc <span class="sc">==</span> <span class="dv">256</span>, <span class="st">"coexistence no mutual invasion"</span>, outcome))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="plotting-pairwise-outpcomes" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="plotting-pairwise-outpcomes"><span class="header-section-number">5.3</span> Plotting pairwise outpcomes</h2>
<p>Construct final dataframe to be used for plotting</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>samp_pairs_fmt <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(samp_pairs_fmt_mp_9010, samp_pairs_fmt_mp_5050, samp_pairs_fmt_exp_9010, samp_pairs_fmt_exp_5050) <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb12-3"><a href="#cb12-3"></a>    <span class="at">group =</span> <span class="fu">interaction</span>(community_id, strep_conc),</span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="at">evo_group =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb12-5"><a href="#cb12-5"></a>      dplyr<span class="sc">::</span><span class="fu">if_all</span>(<span class="fu">c</span>(sp_1, sp_2), \(x) stringr<span class="sc">::</span><span class="fu">str_detect</span>(x, <span class="st">"ANC"</span>)) <span class="sc">~</span> <span class="st">"both_anc"</span>,</span>
<span id="cb12-6"><a href="#cb12-6"></a>      dplyr<span class="sc">::</span><span class="fu">if_all</span>(<span class="fu">c</span>(sp_1, sp_2), \(x) stringr<span class="sc">::</span><span class="fu">str_detect</span>(x, <span class="st">"EVO"</span>)) <span class="sc">~</span> <span class="st">"both_evo"</span>,</span>
<span id="cb12-7"><a href="#cb12-7"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"mix"</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>    )</span>
<span id="cb12-9"><a href="#cb12-9"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb12-10"><a href="#cb12-10"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(outcomes_classified,</span>
<span id="cb12-11"><a href="#cb12-11"></a>                   <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(sp_1, sp_2, strep_conc),</span>
<span id="cb12-12"><a href="#cb12-12"></a>                   <span class="at">relationship =</span> <span class="st">"many-to-many"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-13"><a href="#cb12-13"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb12-14"><a href="#cb12-14"></a>    <span class="at">outcome =</span> <span class="fu">factor</span>(outcome, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"exclusion"</span>, </span>
<span id="cb12-15"><a href="#cb12-15"></a>                                         <span class="st">"towards exclusion"</span>, </span>
<span id="cb12-16"><a href="#cb12-16"></a>                                         <span class="st">"stable coexistence"</span>, </span>
<span id="cb12-17"><a href="#cb12-17"></a>                                         <span class="st">"coexistence no mutual invasion"</span>, </span>
<span id="cb12-18"><a href="#cb12-18"></a>                                         <span class="st">"inconclusive"</span>))</span>
<span id="cb12-19"><a href="#cb12-19"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Create different lists of plots for the mixed (i.e.&nbsp;evo competed against anc) conditions</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>samp_pairs_fmt_plots_split_a <span class="ot">&lt;-</span> samp_pairs_fmt <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(evo_group <span class="sc">!=</span> <span class="st">"mix"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(strep_conc, evo_group) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4"></a>  dplyr<span class="sc">::</span><span class="fu">group_split</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-5"><a href="#cb13-5"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(pair_plot)</span>
<span id="cb13-6"><a href="#cb13-6"></a></span>
<span id="cb13-7"><a href="#cb13-7"></a>samp_pairs_fmt_plots_split_b <span class="ot">&lt;-</span> samp_pairs_fmt <span class="sc">%&gt;%</span> </span>
<span id="cb13-8"><a href="#cb13-8"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(evo_group <span class="sc">==</span> <span class="st">"mix"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-9"><a href="#cb13-9"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(strep_conc) <span class="sc">%&gt;%</span> </span>
<span id="cb13-10"><a href="#cb13-10"></a>  dplyr<span class="sc">::</span><span class="fu">group_split</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-11"><a href="#cb13-11"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(pair_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>fig01 <span class="ot">&lt;-</span> patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(samp_pairs_fmt_plots_split_a, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb15-2"><a href="#cb15-2"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"figs"</span>, <span class="st">"coexistence_pairs.svg"</span>),</span>
<span id="cb15-3"><a href="#cb15-3"></a>  fig01,</span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="at">width =</span> <span class="dv">7</span>,</span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="at">height =</span> <span class="dv">12</span>,</span>
<span id="cb15-6"><a href="#cb15-6"></a>  <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb15-7"><a href="#cb15-7"></a>  <span class="at">device =</span> <span class="st">"svg"</span></span>
<span id="cb15-8"><a href="#cb15-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-01" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-01-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_analysis_pairs_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-01-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Outcomes from pairwise cocultures of both ancestral (left, A:G) and both evolved (right, B:H) 0403, 1287, 1896 and 1977 species. Rows in the grid represent different streptomycin concentrations applied (A:B = 0 µg/ml, C:D = 16 µg/ml, E:F = 64 µg/ml, G:H = 256 µg/ml). Using the rules defined above for competitive outcomes, red lines show “exclusion,” dark red show “towards exclusion,” light blue lines show “stable coexistence,” dark blue lines show “coexistence without evidence for mutual invasion,” and green lines show “inconclusive” outcomes. Some statistical noise has been applied to point positions to prevent overlaps in the plot and aid in visualization.
</figcaption>
</figure>
</div>
<p><strong>NOTE:</strong> in panel E (64 µg/ml streptomycin, ANC_0403 vs ANC_1977) both replicates survived with OD ~ 0.15 when ANC_0403 was started from 90% abundance but not when it was started at 10% abundance (OD ~ 0.04). In all replicates of 90%/10% starting abundance ANC_1977 was driven extinct.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>fig02 <span class="ot">&lt;-</span> patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(samp_pairs_fmt_plots_split_b, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>  patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb17-2"><a href="#cb17-2"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"figs"</span>, <span class="st">"coexistence_pairs_mixed_hist.svg"</span>),</span>
<span id="cb17-3"><a href="#cb17-3"></a>  fig02,</span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="at">width =</span> <span class="dv">7</span>,</span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="at">height =</span> <span class="dv">7</span>,</span>
<span id="cb17-6"><a href="#cb17-6"></a>  <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb17-7"><a href="#cb17-7"></a>  <span class="at">device =</span> <span class="st">"svg"</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-02" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_analysis_pairs_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Results from co-cultures of mixed ancestral and evolved combinations. Line colors and types are as in <a href="#fig-01" class="quarto-xref">Figure&nbsp;1</a>.
</figcaption>
</figure>
</div>
</section>
</section>
<section id="network" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Network</h1>
<p>Here we will plot the pairwise competition outcomes as a network. <strong>NOTE:</strong> I don’t have time/energy to figure out how to manage all the links in the networks so that they line up properly and don’t overlap so there will need to be some postprocessing in inkscape to move some of the links so they don’t overlap.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">library</span>(ggraph)</span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="fu">library</span>(tidygraph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="evolution-and-streptomycin-categories-separate" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="evolution-and-streptomycin-categories-separate"><span class="header-section-number">6.1</span> Evolution and Streptomycin categories separate</h2>
<p>Here we plot a separate graph for each streptomycin concentrations and also by different evolutionary groupings. For example, there is one graph for the competition outcomes of only ancestral species, there is one graph of the outcomes of only evolved species, and there is one graph for the outcomes of mixed competitions where an ancestral species competes against an evolved species.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>nodes1 <span class="ot">&lt;-</span> <span class="fu">make_nodes</span>(samp_pairs_fmt, evo_group, strep_conc)</span>
<span id="cb19-2"><a href="#cb19-2"></a>edges1 <span class="ot">&lt;-</span> <span class="fu">make_edges</span>(samp_pairs_fmt, evo_group, strep_conc)</span>
<span id="cb19-3"><a href="#cb19-3"></a></span>
<span id="cb19-4"><a href="#cb19-4"></a>graphs1 <span class="ot">&lt;-</span> <span class="fu">nest</span>(nodes1, <span class="at">sps =</span> <span class="sc">-</span><span class="fu">c</span>(evo_group, strep_conc)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href="#cb19-5"></a>  <span class="fu">left_join</span>(<span class="fu">nest</span>(edges1, <span class="at">pairs =</span> <span class="sc">-</span><span class="fu">c</span>(evo_group, strep_conc)),</span>
<span id="cb19-6"><a href="#cb19-6"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(evo_group, strep_conc)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-7"><a href="#cb19-7"></a>  <span class="fu">mutate</span>(<span class="at">network =</span> <span class="fu">map2</span>(sps, pairs, <span class="cf">function</span>(sps, pairs) <span class="fu">tbl_graph</span>(<span class="at">nodes =</span> sps, <span class="at">edges =</span> pairs, <span class="at">directed =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb19-8"><a href="#cb19-8"></a>  <span class="fu">mutate</span>(<span class="at">plot =</span> <span class="fu">map</span>(network, <span class="cf">function</span>(network) <span class="fu">plot_network_hierarchy</span>(network, <span class="at">tune_angle =</span> <span class="fl">1.5</span>, <span class="at">n_rank =</span> <span class="dv">7</span>, <span class="at">n_break =</span> <span class="dv">7</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>fig03 <span class="ot">&lt;-</span> patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(graphs1[[<span class="dv">6</span>]], <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">guides=</span> <span class="st">"collect"</span>) <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>  patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb21-2"><a href="#cb21-2"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"figs"</span>, <span class="st">"coexistence_networks_nested_evo_strep.svg"</span>),</span>
<span id="cb21-3"><a href="#cb21-3"></a>  fig03,</span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb21-5"><a href="#cb21-5"></a>  <span class="at">height =</span> <span class="dv">10</span>,</span>
<span id="cb21-6"><a href="#cb21-6"></a>  <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb21-7"><a href="#cb21-7"></a>  <span class="at">device =</span> <span class="st">"svg"</span></span>
<span id="cb21-8"><a href="#cb21-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-03" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_analysis_pairs_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Competitive hierarchy of species pairs separated by evolution grouping (only ancestral pairs, only evolved pairs, and mixed ancestral and evolved pairs) and streptomycin concentration. Subplots A-D are for only ancestral pairs, E-H for only evolved pairs, and I-L for mixed ancestral and evolved pairs. Subplots A, E, I show experiments under no streptomycin, B, F, J 16 µg/ml streptomycin, C, G, K for 64 µg/ml streptomycin, and D, H, L for 256 µg/ml streptomycin. For each evolution/streptomycin grouping, strains are rank ordered on the basis of the number of other strains they exclude, based on data shown in <a href="#fig-01" class="quarto-xref">Figure&nbsp;1</a> and <a href="#fig-02" class="quarto-xref">Figure&nbsp;2</a>. Grey nodes represent strains (denoted by text), red arrows point from winning strain to losing strain, blue arrows indicate coexistence (ignore the arrow heads for blue, coulnd’t figure out how to remove them for only a subset of the edges).
</figcaption>
</figure>
</div>
</section>
<section id="only-streptomycin-category-separate" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="only-streptomycin-category-separate"><span class="header-section-number">6.2</span> Only Streptomycin category separate</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>nodes2 <span class="ot">&lt;-</span> <span class="fu">make_nodes</span>(samp_pairs_fmt, strep_conc)</span>
<span id="cb22-2"><a href="#cb22-2"></a>edges2 <span class="ot">&lt;-</span> <span class="fu">make_edges</span>(samp_pairs_fmt, strep_conc)</span>
<span id="cb22-3"><a href="#cb22-3"></a></span>
<span id="cb22-4"><a href="#cb22-4"></a>graphs2 <span class="ot">&lt;-</span> <span class="fu">nest</span>(nodes2, <span class="at">sps =</span> <span class="sc">-</span><span class="fu">c</span>(strep_conc)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5"></a>  <span class="fu">left_join</span>(<span class="fu">nest</span>(edges2, <span class="at">pairs =</span> <span class="sc">-</span><span class="fu">c</span>(strep_conc)),</span>
<span id="cb22-6"><a href="#cb22-6"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(strep_conc)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-7"><a href="#cb22-7"></a>  <span class="fu">mutate</span>(<span class="at">network =</span> <span class="fu">map2</span>(sps, pairs, <span class="cf">function</span>(sps, pairs) <span class="fu">tbl_graph</span>(<span class="at">nodes =</span> sps, <span class="at">edges =</span> pairs, <span class="at">directed =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8"></a>  <span class="fu">mutate</span>(<span class="at">plot =</span> <span class="fu">map</span>(network, <span class="cf">function</span>(network) <span class="fu">plot_network_hierarchy</span>(network, <span class="at">tune_angle =</span> <span class="fl">1.5</span>, <span class="at">n_rank =</span> <span class="dv">7</span>, <span class="at">n_break =</span> <span class="dv">7</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>fig04 <span class="ot">&lt;-</span> patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(graphs2[[<span class="dv">5</span>]], <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">guides=</span> <span class="st">"collect"</span>) <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>  patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb24-2"><a href="#cb24-2"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"figs"</span>, <span class="st">"coexistence_networks_nested_strep.svg"</span>),</span>
<span id="cb24-3"><a href="#cb24-3"></a>  fig04,</span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="at">width =</span> <span class="dv">9</span>,</span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb24-6"><a href="#cb24-6"></a>  <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb24-7"><a href="#cb24-7"></a>  <span class="at">device =</span> <span class="st">"svg"</span></span>
<span id="cb24-8"><a href="#cb24-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-04" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-04-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_analysis_pairs_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-04-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Competitive hierarchy of species pairs separated by streptomycin concentration. Subplot A shows experiments under no streptomycin, B with 16 µg/ml streptomycin, C with 64 µg/ml streptomycin, and D with 256 µg/ml streptomycin. For each evolution/streptomycin grouping, strains are rank ordered on the basis of the number of other strains they exclude, based on data shown in <a href="#fig-01" class="quarto-xref">Figure&nbsp;1</a> and <a href="#fig-02" class="quarto-xref">Figure&nbsp;2</a>. Grey nodes represent strains (denoted by text), red arrows point from winning strain to losing strain, blue arrows indicate coexistence (ignore the arrow heads for blue, couldn’t figure out how to remove them for only a subset of the edges)
</figcaption>
</figure>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb25" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb25-1"><a href="#cb25-1"></a><span class="co">---</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="an">title:</span><span class="co"> "Analysis of pairwise competition"</span></span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="an">author:</span><span class="co"> "Shane Hogle"</span></span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="an">link-citations:</span><span class="co"> true</span></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="an">abstract:</span><span class="co"> "Here we analyze the community outpcomes from all competing species pairs."</span></span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="co">---</span></span>
<span id="cb25-8"><a href="#cb25-8"></a></span>
<span id="cb25-9"><a href="#cb25-9"></a><span class="fu"># Introduction</span></span>
<span id="cb25-10"><a href="#cb25-10"></a></span>
<span id="cb25-11"><a href="#cb25-11"></a>Contains results from pairs of all streptomycin concentrations and trios for 0 streptomycin</span>
<span id="cb25-12"><a href="#cb25-12"></a></span>
<span id="cb25-13"><a href="#cb25-13"></a><span class="fu"># Setup</span></span>
<span id="cb25-14"><a href="#cb25-14"></a></span>
<span id="cb25-15"><a href="#cb25-15"></a><span class="fu">## Libraries</span></span>
<span id="cb25-16"><a href="#cb25-16"></a></span>
<span id="cb25-19"><a href="#cb25-19"></a><span class="in">```{r}</span></span>
<span id="cb25-20"><a href="#cb25-20"></a><span class="co">#| output: false</span></span>
<span id="cb25-21"><a href="#cb25-21"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb25-22"><a href="#cb25-22"></a><span class="fu">library</span>(here)</span>
<span id="cb25-23"><a href="#cb25-23"></a><span class="fu">library</span>(fs)</span>
<span id="cb25-24"><a href="#cb25-24"></a><span class="fu">library</span>(scales)</span>
<span id="cb25-25"><a href="#cb25-25"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb25-26"><a href="#cb25-26"></a><span class="fu">library</span>(broom)</span>
<span id="cb25-27"><a href="#cb25-27"></a><span class="fu">library</span>(ggraph)</span>
<span id="cb25-28"><a href="#cb25-28"></a><span class="fu">library</span>(tidygraph)</span>
<span id="cb25-29"><a href="#cb25-29"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"utils_generic.R"</span>))</span>
<span id="cb25-30"><a href="#cb25-30"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"communities"</span>, <span class="st">"amplicon"</span>, <span class="st">"utils_amplicon.R"</span>))</span>
<span id="cb25-31"><a href="#cb25-31"></a><span class="in">```</span></span>
<span id="cb25-32"><a href="#cb25-32"></a></span>
<span id="cb25-33"><a href="#cb25-33"></a><span class="fu">## Global variables</span></span>
<span id="cb25-34"><a href="#cb25-34"></a></span>
<span id="cb25-37"><a href="#cb25-37"></a><span class="in">```{r}</span></span>
<span id="cb25-38"><a href="#cb25-38"></a>data <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"communities"</span>)</span>
<span id="cb25-39"><a href="#cb25-39"></a><span class="co"># make processed data directory if it doesn't exist</span></span>
<span id="cb25-40"><a href="#cb25-40"></a>fs<span class="sc">::</span><span class="fu">dir_create</span>(data)</span>
<span id="cb25-41"><a href="#cb25-41"></a><span class="in">```</span></span>
<span id="cb25-42"><a href="#cb25-42"></a></span>
<span id="cb25-43"><a href="#cb25-43"></a><span class="fu"># Read data</span></span>
<span id="cb25-44"><a href="#cb25-44"></a></span>
<span id="cb25-45"><a href="#cb25-45"></a><span class="fu">## Species abundances</span></span>
<span id="cb25-46"><a href="#cb25-46"></a></span>
<span id="cb25-49"><a href="#cb25-49"></a><span class="in">```{r}</span></span>
<span id="cb25-50"><a href="#cb25-50"></a><span class="co">#| output: false</span></span>
<span id="cb25-51"><a href="#cb25-51"></a>samp_pairs_9010 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(here<span class="sc">::</span><span class="fu">here</span>(data, <span class="st">"2sps_compiled_9010.tsv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-52"><a href="#cb25-52"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">f =</span> f_thresh)</span>
<span id="cb25-53"><a href="#cb25-53"></a></span>
<span id="cb25-54"><a href="#cb25-54"></a>samp_pairs_5050 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(here<span class="sc">::</span><span class="fu">here</span>(data, <span class="st">"2sps_compiled_5050.tsv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-55"><a href="#cb25-55"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">f =</span> f_thresh)</span>
<span id="cb25-56"><a href="#cb25-56"></a><span class="in">```</span></span>
<span id="cb25-57"><a href="#cb25-57"></a></span>
<span id="cb25-58"><a href="#cb25-58"></a><span class="fu"># Formatting</span></span>
<span id="cb25-59"><a href="#cb25-59"></a></span>
<span id="cb25-60"><a href="#cb25-60"></a><span class="fu">## Transfer 0 (starting proportions)</span></span>
<span id="cb25-61"><a href="#cb25-61"></a></span>
<span id="cb25-62"><a href="#cb25-62"></a>First get abundances from transfer 0 (masterplate)</span>
<span id="cb25-63"><a href="#cb25-63"></a></span>
<span id="cb25-66"><a href="#cb25-66"></a><span class="in">```{r}</span></span>
<span id="cb25-67"><a href="#cb25-67"></a>format_master <span class="ot">&lt;-</span> <span class="cf">function</span>(.data){</span>
<span id="cb25-68"><a href="#cb25-68"></a>  .data <span class="sc">%&gt;%</span> </span>
<span id="cb25-69"><a href="#cb25-69"></a>      <span class="co"># make a combined evolution and species identifier and extract the community ID</span></span>
<span id="cb25-70"><a href="#cb25-70"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sp =</span> <span class="fu">paste</span>(<span class="fu">str_to_upper</span>(evo_hist), <span class="fu">str_extract</span>(strainID, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>), <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb25-71"><a href="#cb25-71"></a>         <span class="at">community_id =</span> <span class="fu">str_extract</span>(sample, <span class="st">"P</span><span class="sc">\\</span><span class="st">d</span><span class="sc">\\</span><span class="st">d"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-72"><a href="#cb25-72"></a>  <span class="co"># this step is important to ensure that when dfs are pivoted wider the </span></span>
<span id="cb25-73"><a href="#cb25-73"></a>  <span class="co"># sp_1 and sp_2 stay consistent </span></span>
<span id="cb25-74"><a href="#cb25-74"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(community_id, sp) <span class="sc">%&gt;%</span></span>
<span id="cb25-75"><a href="#cb25-75"></a>  <span class="co"># this creates an index for each species present in each community, it is needed</span></span>
<span id="cb25-76"><a href="#cb25-76"></a>  <span class="co"># for the pivot to be consistent between the master plate and the samples</span></span>
<span id="cb25-77"><a href="#cb25-77"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(community_id) <span class="sc">%&gt;%</span> </span>
<span id="cb25-78"><a href="#cb25-78"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb25-79"><a href="#cb25-79"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-80"><a href="#cb25-80"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> community_id, <span class="at">values_from =</span> <span class="fu">c</span>(sp, f), <span class="at">names_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb25-81"><a href="#cb25-81"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">transfer =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-82"><a href="#cb25-82"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">strep_conc =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">16</span>, <span class="dv">64</span>, <span class="dv">256</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-83"><a href="#cb25-83"></a>  <span class="fu">arrange</span>(sp_1, sp_2, strep_conc) <span class="sc">%&gt;%</span> </span>
<span id="cb25-84"><a href="#cb25-84"></a>  <span class="fu">arrange</span>(community_id)</span>
<span id="cb25-85"><a href="#cb25-85"></a>}  </span>
<span id="cb25-86"><a href="#cb25-86"></a><span class="in">```</span></span>
<span id="cb25-87"><a href="#cb25-87"></a></span>
<span id="cb25-90"><a href="#cb25-90"></a><span class="in">```{r}</span></span>
<span id="cb25-91"><a href="#cb25-91"></a>samp_pairs_fmt_mp_9010 <span class="ot">&lt;-</span> samp_pairs_9010 <span class="sc">%&gt;%</span> </span>
<span id="cb25-92"><a href="#cb25-92"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(community_type, <span class="st">"master"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-93"><a href="#cb25-93"></a>  <span class="fu">format_master</span>()</span>
<span id="cb25-94"><a href="#cb25-94"></a>  </span>
<span id="cb25-95"><a href="#cb25-95"></a>samp_pairs_fmt_mp_5050 <span class="ot">&lt;-</span> samp_pairs_5050 <span class="sc">%&gt;%</span> </span>
<span id="cb25-96"><a href="#cb25-96"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(community_type, <span class="st">"master"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-97"><a href="#cb25-97"></a>  <span class="fu">format_master</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-98"><a href="#cb25-98"></a>  <span class="fu">mutate</span>(<span class="at">community_id =</span> <span class="fu">paste0</span>(<span class="st">"P"</span>, <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(community_id, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>))<span class="sc">+</span><span class="dv">48</span>))</span>
<span id="cb25-99"><a href="#cb25-99"></a><span class="in">```</span></span>
<span id="cb25-100"><a href="#cb25-100"></a></span>
<span id="cb25-101"><a href="#cb25-101"></a><span class="fu">## Transfer 8 (ending proportions)</span></span>
<span id="cb25-102"><a href="#cb25-102"></a></span>
<span id="cb25-103"><a href="#cb25-103"></a>Format abundances from the experiment, summarizing over replicates. Here we calculate the median frequency across biological replicates using <span class="in">`Hmisc::smedian.hilow`</span> which computes the sample median and the outer quantiles (0.025 and 0.975).</span>
<span id="cb25-104"><a href="#cb25-104"></a></span>
<span id="cb25-107"><a href="#cb25-107"></a><span class="in">```{r}</span></span>
<span id="cb25-108"><a href="#cb25-108"></a>samp_pairs_fmt_exp_9010 <span class="ot">&lt;-</span> samp_pairs_9010 <span class="sc">%&gt;%</span> </span>
<span id="cb25-109"><a href="#cb25-109"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(community_type <span class="sc">==</span> <span class="st">"experiment"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-110"><a href="#cb25-110"></a>  <span class="co"># make a combined evolution and species identifier and extract the community ID</span></span>
<span id="cb25-111"><a href="#cb25-111"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sp =</span> <span class="fu">paste</span>(<span class="fu">str_to_upper</span>(evo_hist), <span class="fu">str_extract</span>(strainID, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>), <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb25-112"><a href="#cb25-112"></a>         <span class="at">community_id =</span> <span class="fu">str_extract</span>(sample, <span class="st">"P</span><span class="sc">\\</span><span class="st">d</span><span class="sc">\\</span><span class="st">d"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-113"><a href="#cb25-113"></a>  <span class="co"># calculate median and 95% CI across replicates</span></span>
<span id="cb25-114"><a href="#cb25-114"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(ggplot2<span class="sc">::</span><span class="fu">median_hilow</span>(f), <span class="at">.by =</span> <span class="fu">c</span>(<span class="st">"community_id"</span>, <span class="st">"sp"</span>, <span class="st">"strep_conc"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-115"><a href="#cb25-115"></a>  <span class="co"># rename the y columns as f for compatibility</span></span>
<span id="cb25-116"><a href="#cb25-116"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">"y"</span>), \(x) <span class="fu">str_replace</span>(x, <span class="st">"y"</span>, <span class="st">"f"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-117"><a href="#cb25-117"></a>  <span class="co"># this step is important to ensure that when dfs are pivoted wider the </span></span>
<span id="cb25-118"><a href="#cb25-118"></a>  <span class="co"># sp_1 and sp_2 stay consistent </span></span>
<span id="cb25-119"><a href="#cb25-119"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(community_id, sp, strep_conc) <span class="sc">%&gt;%</span></span>
<span id="cb25-120"><a href="#cb25-120"></a>  <span class="co"># this creates an index for each species present in each community, it is needed</span></span>
<span id="cb25-121"><a href="#cb25-121"></a>  <span class="co"># for the pivot to be consistent between the master plate and the samples</span></span>
<span id="cb25-122"><a href="#cb25-122"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(community_id, strep_conc) <span class="sc">%&gt;%</span> </span>
<span id="cb25-123"><a href="#cb25-123"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb25-124"><a href="#cb25-124"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-125"><a href="#cb25-125"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(community_id, strep_conc), <span class="at">values_from =</span> <span class="fu">c</span>(sp, f, fmin, fmax), <span class="at">names_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb25-126"><a href="#cb25-126"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">transfer =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-127"><a href="#cb25-127"></a>  <span class="fu">arrange</span>(sp_1, sp_2, strep_conc)</span>
<span id="cb25-128"><a href="#cb25-128"></a><span class="in">```</span></span>
<span id="cb25-129"><a href="#cb25-129"></a></span>
<span id="cb25-132"><a href="#cb25-132"></a><span class="in">```{r}</span></span>
<span id="cb25-133"><a href="#cb25-133"></a>samp_pairs_fmt_exp_5050 <span class="ot">&lt;-</span> samp_pairs_5050 <span class="sc">%&gt;%</span> </span>
<span id="cb25-134"><a href="#cb25-134"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(community_type <span class="sc">==</span> <span class="st">"experiment"</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb25-135"><a href="#cb25-135"></a>  <span class="co"># make a combined evolution and species identifier and extract the community ID</span></span>
<span id="cb25-136"><a href="#cb25-136"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sp =</span> <span class="fu">paste</span>(<span class="fu">str_to_upper</span>(evo_hist), <span class="fu">str_extract</span>(strainID, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>), <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb25-137"><a href="#cb25-137"></a>         <span class="at">community_id =</span> <span class="fu">str_extract</span>(sample, <span class="st">"P</span><span class="sc">\\</span><span class="st">d</span><span class="sc">\\</span><span class="st">d"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-138"><a href="#cb25-138"></a>  <span class="fu">arrange</span>(community_id, strep_conc) <span class="sc">%&gt;%</span> </span>
<span id="cb25-139"><a href="#cb25-139"></a>  <span class="co"># there is only one replicate so we can't calculate median/mean</span></span>
<span id="cb25-140"><a href="#cb25-140"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(community_id, sp, strep_conc) <span class="sc">%&gt;%</span></span>
<span id="cb25-141"><a href="#cb25-141"></a>  <span class="co"># this creates an index for each species present in each community, it is needed</span></span>
<span id="cb25-142"><a href="#cb25-142"></a>  <span class="co"># for the pivot to be consistent between the master plate and the samples</span></span>
<span id="cb25-143"><a href="#cb25-143"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(community_id, strep_conc) <span class="sc">%&gt;%</span> </span>
<span id="cb25-144"><a href="#cb25-144"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb25-145"><a href="#cb25-145"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-146"><a href="#cb25-146"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(community_id, strep_conc), <span class="at">values_from =</span> <span class="fu">c</span>(sp, f), <span class="at">names_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb25-147"><a href="#cb25-147"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">transfer =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-148"><a href="#cb25-148"></a>  <span class="fu">arrange</span>(sp_1, sp_2, strep_conc) <span class="sc">%&gt;%</span> </span>
<span id="cb25-149"><a href="#cb25-149"></a>  <span class="fu">arrange</span>(community_id) <span class="sc">%&gt;%</span> </span>
<span id="cb25-150"><a href="#cb25-150"></a>  <span class="fu">mutate</span>(<span class="at">community_id =</span> <span class="fu">paste0</span>(<span class="st">"P"</span>, <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(community_id, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>))<span class="sc">+</span><span class="dv">48</span>))</span>
<span id="cb25-151"><a href="#cb25-151"></a><span class="in">```</span></span>
<span id="cb25-152"><a href="#cb25-152"></a></span>
<span id="cb25-153"><a href="#cb25-153"></a><span class="fu"># Define competition outcomes</span></span>
<span id="cb25-154"><a href="#cb25-154"></a></span>
<span id="cb25-155"><a href="#cb25-155"></a><span class="fu">## Binomial sampling and Wilcox test</span></span>
<span id="cb25-156"><a href="#cb25-156"></a></span>
<span id="cb25-157"><a href="#cb25-157"></a>First need to determine which samples significantly decreased/increased from T0 to T8. We don't have enough biological replicates for to compute a statistic across replicates for <span class="co">[</span><span class="ot">outcome variability</span><span class="co">](https://www.pnas.org/doi/10.1073/pnas.2302491120)</span>. However, we can estimate the mean fraction of A and quantify the inferential uncertainty of the mean by bootstrap resampling. We the used median proportion of species A from two biological replicates of each T8 pair as the probability of success (i.e., drawing species A) from 1000 draws (i.e., sequencing reads) from the binomial distribution. To determine whether the frequency of Species A significantly changed from T0 to T8, the means of the 1000 binomial draws for T0 and T8 were compared using a Wilcoxon rank sum test (N = 2000). Tests with Bonferroni multiple test corrected p values &lt; 1e-5 were considered to represent significantly different T0 and T8 samples.  </span>
<span id="cb25-158"><a href="#cb25-158"></a></span>
<span id="cb25-161"><a href="#cb25-161"></a><span class="in">```{r}</span></span>
<span id="cb25-162"><a href="#cb25-162"></a>wc_test <span class="ot">&lt;-</span> <span class="cf">function</span>(df1, df2){</span>
<span id="cb25-163"><a href="#cb25-163"></a>  <span class="co"># first join the T0 and T8 abundances</span></span>
<span id="cb25-164"><a href="#cb25-164"></a>  <span class="fu">left_join</span>(df1, df2, <span class="at">by =</span> <span class="fu">join_by</span>(community_id, strep_conc, sp_1, sp_2)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-165"><a href="#cb25-165"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">delta_f_1 =</span> f_1.x <span class="sc">-</span> f_1.y) <span class="sc">%&gt;%</span> </span>
<span id="cb25-166"><a href="#cb25-166"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(community_id, strep_conc, sp_1, sp_2, delta_f_1, <span class="at">f_1_8 =</span> f_1.x, <span class="at">f_1_0 =</span> f_1.y, </span>
<span id="cb25-167"><a href="#cb25-167"></a>                <span class="at">f_2_8 =</span> f_2.x, <span class="at">f_2_0 =</span> f_2.y) <span class="sc">%&gt;%</span> </span>
<span id="cb25-168"><a href="#cb25-168"></a>  tidyr<span class="sc">::</span><span class="fu">nest</span>(<span class="at">data =</span> <span class="fu">c</span>(<span class="sc">-</span>community_id, <span class="sc">-</span>strep_conc)) <span class="sc">%&gt;%</span></span>
<span id="cb25-169"><a href="#cb25-169"></a>  <span class="co"># samples 1000 draws from binomial distribution using f_a median as the probability of success</span></span>
<span id="cb25-170"><a href="#cb25-170"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">f_1_0_rs =</span> purrr<span class="sc">::</span><span class="fu">map</span>(data, \(x) <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, \(i) <span class="fu">sum</span>(<span class="fu">rbinom</span>(<span class="dv">1000</span>, <span class="dv">1</span>, x<span class="sc">$</span>f_1_0))<span class="sc">/</span><span class="dv">1000</span>)),</span>
<span id="cb25-171"><a href="#cb25-171"></a>         <span class="at">f_1_8_rs =</span> purrr<span class="sc">::</span><span class="fu">map</span>(data, \(x) <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, \(i) <span class="fu">sum</span>(<span class="fu">rbinom</span>(<span class="dv">1000</span>, <span class="dv">1</span>, x<span class="sc">$</span>f_1_8))<span class="sc">/</span><span class="dv">1000</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb25-172"><a href="#cb25-172"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(data, f_1_0_rs, f_1_8_rs)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-173"><a href="#cb25-173"></a>  <span class="co"># nest the samples</span></span>
<span id="cb25-174"><a href="#cb25-174"></a>  tidyr<span class="sc">::</span><span class="fu">nest</span>(<span class="at">bs =</span> <span class="fu">c</span>(f_1_0_rs, f_1_8_rs)) <span class="sc">%&gt;%</span></span>
<span id="cb25-175"><a href="#cb25-175"></a>  <span class="co"># perform the wilcox test</span></span>
<span id="cb25-176"><a href="#cb25-176"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">wc =</span> purrr<span class="sc">::</span><span class="fu">map</span>(bs, \(i) <span class="fu">wilcox.test</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(i<span class="sc">$</span>f_1_0_rs), <span class="at">y =</span> <span class="fu">as.numeric</span>(i<span class="sc">$</span>f_1_8_rs)))) <span class="sc">%&gt;%</span> </span>
<span id="cb25-177"><a href="#cb25-177"></a>  <span class="co"># tidy-ify the test output</span></span>
<span id="cb25-178"><a href="#cb25-178"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">tidy_wc =</span> purrr<span class="sc">::</span><span class="fu">map</span>(wc, \(x) broom<span class="sc">::</span><span class="fu">tidy</span>(x))) <span class="sc">%&gt;%</span> </span>
<span id="cb25-179"><a href="#cb25-179"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(tidy_wc)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-180"><a href="#cb25-180"></a>  <span class="co"># p-value adjust using bonferroni correction</span></span>
<span id="cb25-181"><a href="#cb25-181"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">p_adjusted =</span> <span class="fu">p.adjust</span>(p.value, <span class="at">method =</span> <span class="st">"bonferroni"</span>, <span class="at">n =</span> <span class="fu">n</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb25-182"><a href="#cb25-182"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(strep_conc, sp_1, sp_2) <span class="sc">%&gt;%</span> </span>
<span id="cb25-183"><a href="#cb25-183"></a>  <span class="co"># define whether change is significantly positive or negative</span></span>
<span id="cb25-184"><a href="#cb25-184"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">change =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(p.value <span class="sc">&gt;</span> <span class="fl">1e-5</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb25-185"><a href="#cb25-185"></a>                             <span class="fu">sign</span>(delta_f_1) <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">&amp;</span> p.value <span class="sc">&lt;=</span> <span class="fl">1e-5</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb25-186"><a href="#cb25-186"></a>                             <span class="fu">sign</span>(delta_f_1) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> p.value <span class="sc">&lt;=</span> <span class="fl">1e-5</span> <span class="sc">~</span> <span class="dv">1</span>)) </span>
<span id="cb25-187"><a href="#cb25-187"></a>}</span>
<span id="cb25-188"><a href="#cb25-188"></a><span class="in">```</span></span>
<span id="cb25-189"><a href="#cb25-189"></a></span>
<span id="cb25-190"><a href="#cb25-190"></a>run the tests</span>
<span id="cb25-191"><a href="#cb25-191"></a></span>
<span id="cb25-194"><a href="#cb25-194"></a><span class="in">```{r}</span></span>
<span id="cb25-195"><a href="#cb25-195"></a><span class="fu">set.seed</span>(<span class="dv">124341</span>)</span>
<span id="cb25-196"><a href="#cb25-196"></a></span>
<span id="cb25-197"><a href="#cb25-197"></a>wc_test_9010 <span class="ot">&lt;-</span> <span class="fu">wc_test</span>(samp_pairs_fmt_exp_9010, samp_pairs_fmt_mp_9010)</span>
<span id="cb25-198"><a href="#cb25-198"></a>wc_test_5050 <span class="ot">&lt;-</span> <span class="fu">wc_test</span>(samp_pairs_fmt_exp_5050, samp_pairs_fmt_mp_5050)</span>
<span id="cb25-199"><a href="#cb25-199"></a><span class="in">```</span></span>
<span id="cb25-200"><a href="#cb25-200"></a></span>
<span id="cb25-201"><a href="#cb25-201"></a><span class="fu">## Competition outcome rules</span></span>
<span id="cb25-202"><a href="#cb25-202"></a></span>
<span id="cb25-203"><a href="#cb25-203"></a>Here we set up the rules for defining the competition outcomes. In the pairwise competition experiments each species and evolutionary form was competed against all other species and evolutionary forms (excluding evolutionary forms of the same species because these cannot be resolved using amplicon data). Each competitor in a pair $<span class="sc">\{</span>A, B<span class="sc">\}</span>$ was allowed to invade from rare ($f^{R} = 0.1$) while the other competitor was common ($f^{C} = 0.9$) in duplicate for 8 growth cycles. Additionally we completed one experiment where each strain in the pair was started at roughly equal density. This resulted in 6 experiments for each competing pair. Using the abundance outcomes from both replicates of each the pairwise competition experiments for each pair we classified outcomes as "exclusion", "towards exclusion", "stable coexistence", "coexistence without evidence for mutual invasion", or "inconclusive" according to the following criteria (also see: https://www.science.org/doi/10.1126/science.adg0727)</span>
<span id="cb25-204"><a href="#cb25-204"></a></span>
<span id="cb25-205"><a href="#cb25-205"></a><span class="fu">### Exclusion</span></span>
<span id="cb25-206"><a href="#cb25-206"></a></span>
<span id="cb25-207"><a href="#cb25-207"></a>Requires one species ($A$) in a pair to be excluded ($f_{A} = 0$) in all 6 experiments for the species pair.</span>
<span id="cb25-208"><a href="#cb25-208"></a></span>
<span id="cb25-209"><a href="#cb25-209"></a><span class="fu">### Towards Exclusion</span></span>
<span id="cb25-210"><a href="#cb25-210"></a></span>
<span id="cb25-211"><a href="#cb25-211"></a>Relaxes the condition that ($f_{A} = 0$), but requires one species in a pair to have a significant decrease ($\Delta f_{8-0} &lt; 0$) (Wilcoxon Test) in all 6 experiments for the species pair.</span>
<span id="cb25-212"><a href="#cb25-212"></a></span>
<span id="cb25-213"><a href="#cb25-213"></a><span class="fu">### Stable Coexistence</span></span>
<span id="cb25-214"><a href="#cb25-214"></a>Both species $A$ and $B$ can stably coexist if each species can invade the other from low frequency $A_{f_{A} &lt; f_{B}} \rightarrow B \vee B_{f_{B} &lt; f_{A}} \rightarrow A$. Assignment of stable coexistence was made by comparing $sgn(\Delta f_{8-0}) = sgn(\bar{f_{8}} - f_{0})$ where $\bar{f_{8}}$ is the mean frequency of the species at the final sampling timepoint across all 6 experiments.</span>
<span id="cb25-215"><a href="#cb25-215"></a></span>
<span id="cb25-216"><a href="#cb25-216"></a><span class="fu">### Coexistence without evidence for mutual invasion</span></span>
<span id="cb25-217"><a href="#cb25-217"></a>This outcome was assigned when each species had a non-zero frequency $f_{A|B} &gt; 0$ in all 6 experiments at the final time point. </span>
<span id="cb25-218"><a href="#cb25-218"></a></span>
<span id="cb25-219"><a href="#cb25-219"></a><span class="fu">### Inconclusive</span></span>
<span id="cb25-220"><a href="#cb25-220"></a></span>
<span id="cb25-221"><a href="#cb25-221"></a>This outcome was assigned when none of the above conditions were met.</span>
<span id="cb25-222"><a href="#cb25-222"></a></span>
<span id="cb25-225"><a href="#cb25-225"></a><span class="in">```{r}</span></span>
<span id="cb25-226"><a href="#cb25-226"></a>outcomes_classified <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(wc_test_9010, wc_test_5050) <span class="sc">%&gt;%</span> </span>
<span id="cb25-227"><a href="#cb25-227"></a>  <span class="fu">arrange</span>(sp_1, sp_2, strep_conc) <span class="sc">%&gt;%</span> </span>
<span id="cb25-228"><a href="#cb25-228"></a>  <span class="fu">group_by</span>(sp_1, sp_2, strep_conc) <span class="sc">%&gt;%</span></span>
<span id="cb25-229"><a href="#cb25-229"></a>  <span class="fu">mutate</span>(<span class="at">outcome =</span> <span class="fu">case_when</span>(</span>
<span id="cb25-230"><a href="#cb25-230"></a>    <span class="co"># condition 1</span></span>
<span id="cb25-231"><a href="#cb25-231"></a>    <span class="fu">sum</span>(f_1_8 <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">==</span> <span class="fu">n</span>() <span class="sc">|</span> <span class="fu">sum</span>(f_1_8 <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">==</span> <span class="fu">n</span>() <span class="sc">~</span> <span class="st">"exclusion"</span>,</span>
<span id="cb25-232"><a href="#cb25-232"></a>    <span class="co"># condition 2</span></span>
<span id="cb25-233"><a href="#cb25-233"></a>    <span class="fu">sum</span>(change) <span class="sc">==</span> <span class="fu">n</span>() <span class="sc">|</span> <span class="fu">sum</span>(change) <span class="sc">==</span> <span class="sc">-</span><span class="fu">n</span>() <span class="sc">~</span> <span class="st">"towards exclusion"</span>,</span>
<span id="cb25-234"><a href="#cb25-234"></a>    <span class="co"># condition 3</span></span>
<span id="cb25-235"><a href="#cb25-235"></a>    <span class="fu">sum</span>(<span class="fu">sign</span>(f_1_8 <span class="sc">-</span> f_1_0) <span class="sc">==</span> <span class="fu">sign</span>(<span class="fu">mean</span>(f_1_8)<span class="sc">-</span>f_1_0)) <span class="sc">==</span> <span class="fu">n</span>() <span class="sc">~</span> <span class="st">"stable coexistence"</span>,</span>
<span id="cb25-236"><a href="#cb25-236"></a>    <span class="co"># condition 4</span></span>
<span id="cb25-237"><a href="#cb25-237"></a>    <span class="fu">sum</span>(f_1_8 <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">==</span> <span class="fu">n</span>() <span class="sc">~</span> <span class="st">"coexistence no mutual invasion"</span>,</span>
<span id="cb25-238"><a href="#cb25-238"></a>    <span class="co"># all others are inconclusive</span></span>
<span id="cb25-239"><a href="#cb25-239"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"inconclusive"</span></span>
<span id="cb25-240"><a href="#cb25-240"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb25-241"><a href="#cb25-241"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb25-242"><a href="#cb25-242"></a><span class="in">```</span></span>
<span id="cb25-243"><a href="#cb25-243"></a></span>
<span id="cb25-244"><a href="#cb25-244"></a>EVO_1287 and EVO_1977 at 256 ug/ml streptomycin technically fullfill the requirements for the outcome "towards exclusion." However, the patterns at 64 and 16 ug/ml suggest that it could also be "coexistence no mutual invasion." Assigning coexistence no mutual invasion would break an intransitive loop apparent in the pairs network.</span>
<span id="cb25-245"><a href="#cb25-245"></a></span>
<span id="cb25-248"><a href="#cb25-248"></a><span class="in">```{r}</span></span>
<span id="cb25-249"><a href="#cb25-249"></a>outcomes_classified <span class="ot">&lt;-</span> outcomes_classified <span class="sc">%&gt;%</span> </span>
<span id="cb25-250"><a href="#cb25-250"></a>  <span class="fu">mutate</span>(<span class="at">outcome =</span> <span class="fu">if_else</span>(sp_1 <span class="sc">==</span> <span class="st">"EVO_1287"</span> <span class="sc">&amp;</span> sp_2 <span class="sc">==</span> <span class="st">"EVO_1977"</span> <span class="sc">&amp;</span> strep_conc <span class="sc">==</span> <span class="dv">256</span>, <span class="st">"coexistence no mutual invasion"</span>, outcome))</span>
<span id="cb25-251"><a href="#cb25-251"></a><span class="in">```</span></span>
<span id="cb25-252"><a href="#cb25-252"></a></span>
<span id="cb25-253"><a href="#cb25-253"></a><span class="fu">## Plotting pairwise outpcomes</span></span>
<span id="cb25-254"><a href="#cb25-254"></a></span>
<span id="cb25-255"><a href="#cb25-255"></a>Construct final dataframe to be used for plotting</span>
<span id="cb25-256"><a href="#cb25-256"></a></span>
<span id="cb25-259"><a href="#cb25-259"></a><span class="in">```{r}</span></span>
<span id="cb25-260"><a href="#cb25-260"></a>samp_pairs_fmt <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(samp_pairs_fmt_mp_9010, samp_pairs_fmt_mp_5050, samp_pairs_fmt_exp_9010, samp_pairs_fmt_exp_5050) <span class="sc">%&gt;%</span></span>
<span id="cb25-261"><a href="#cb25-261"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb25-262"><a href="#cb25-262"></a>    <span class="at">group =</span> <span class="fu">interaction</span>(community_id, strep_conc),</span>
<span id="cb25-263"><a href="#cb25-263"></a>    <span class="at">evo_group =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb25-264"><a href="#cb25-264"></a>      dplyr<span class="sc">::</span><span class="fu">if_all</span>(<span class="fu">c</span>(sp_1, sp_2), \(x) stringr<span class="sc">::</span><span class="fu">str_detect</span>(x, <span class="st">"ANC"</span>)) <span class="sc">~</span> <span class="st">"both_anc"</span>,</span>
<span id="cb25-265"><a href="#cb25-265"></a>      dplyr<span class="sc">::</span><span class="fu">if_all</span>(<span class="fu">c</span>(sp_1, sp_2), \(x) stringr<span class="sc">::</span><span class="fu">str_detect</span>(x, <span class="st">"EVO"</span>)) <span class="sc">~</span> <span class="st">"both_evo"</span>,</span>
<span id="cb25-266"><a href="#cb25-266"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"mix"</span></span>
<span id="cb25-267"><a href="#cb25-267"></a>    )</span>
<span id="cb25-268"><a href="#cb25-268"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb25-269"><a href="#cb25-269"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(outcomes_classified,</span>
<span id="cb25-270"><a href="#cb25-270"></a>                   <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(sp_1, sp_2, strep_conc),</span>
<span id="cb25-271"><a href="#cb25-271"></a>                   <span class="at">relationship =</span> <span class="st">"many-to-many"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-272"><a href="#cb25-272"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb25-273"><a href="#cb25-273"></a>    <span class="at">outcome =</span> <span class="fu">factor</span>(outcome, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"exclusion"</span>, </span>
<span id="cb25-274"><a href="#cb25-274"></a>                                         <span class="st">"towards exclusion"</span>, </span>
<span id="cb25-275"><a href="#cb25-275"></a>                                         <span class="st">"stable coexistence"</span>, </span>
<span id="cb25-276"><a href="#cb25-276"></a>                                         <span class="st">"coexistence no mutual invasion"</span>, </span>
<span id="cb25-277"><a href="#cb25-277"></a>                                         <span class="st">"inconclusive"</span>))</span>
<span id="cb25-278"><a href="#cb25-278"></a>  ) </span>
<span id="cb25-279"><a href="#cb25-279"></a><span class="in">```</span></span>
<span id="cb25-280"><a href="#cb25-280"></a></span>
<span id="cb25-281"><a href="#cb25-281"></a>Create different lists of plots for the mixed (i.e. evo competed against anc) conditions</span>
<span id="cb25-282"><a href="#cb25-282"></a></span>
<span id="cb25-285"><a href="#cb25-285"></a><span class="in">```{r}</span></span>
<span id="cb25-286"><a href="#cb25-286"></a>samp_pairs_fmt_plots_split_a <span class="ot">&lt;-</span> samp_pairs_fmt <span class="sc">%&gt;%</span> </span>
<span id="cb25-287"><a href="#cb25-287"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(evo_group <span class="sc">!=</span> <span class="st">"mix"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-288"><a href="#cb25-288"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(strep_conc, evo_group) <span class="sc">%&gt;%</span> </span>
<span id="cb25-289"><a href="#cb25-289"></a>  dplyr<span class="sc">::</span><span class="fu">group_split</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-290"><a href="#cb25-290"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(pair_plot)</span>
<span id="cb25-291"><a href="#cb25-291"></a></span>
<span id="cb25-292"><a href="#cb25-292"></a>samp_pairs_fmt_plots_split_b <span class="ot">&lt;-</span> samp_pairs_fmt <span class="sc">%&gt;%</span> </span>
<span id="cb25-293"><a href="#cb25-293"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(evo_group <span class="sc">==</span> <span class="st">"mix"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-294"><a href="#cb25-294"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(strep_conc) <span class="sc">%&gt;%</span> </span>
<span id="cb25-295"><a href="#cb25-295"></a>  dplyr<span class="sc">::</span><span class="fu">group_split</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-296"><a href="#cb25-296"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(pair_plot)</span>
<span id="cb25-297"><a href="#cb25-297"></a><span class="in">```</span></span>
<span id="cb25-298"><a href="#cb25-298"></a></span>
<span id="cb25-301"><a href="#cb25-301"></a><span class="in">```{r}</span></span>
<span id="cb25-302"><a href="#cb25-302"></a><span class="co">#| warning: false</span></span>
<span id="cb25-303"><a href="#cb25-303"></a>fig01 <span class="ot">&lt;-</span> patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(samp_pairs_fmt_plots_split_a, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb25-304"><a href="#cb25-304"></a>  patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>)</span>
<span id="cb25-305"><a href="#cb25-305"></a><span class="in">```</span></span>
<span id="cb25-306"><a href="#cb25-306"></a></span>
<span id="cb25-309"><a href="#cb25-309"></a><span class="in">```{r}</span></span>
<span id="cb25-310"><a href="#cb25-310"></a><span class="co">#| eval: false</span></span>
<span id="cb25-311"><a href="#cb25-311"></a><span class="co">#| include: true</span></span>
<span id="cb25-312"><a href="#cb25-312"></a><span class="fu">ggsave</span>(</span>
<span id="cb25-313"><a href="#cb25-313"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"figs"</span>, <span class="st">"coexistence_pairs.svg"</span>),</span>
<span id="cb25-314"><a href="#cb25-314"></a>  fig01,</span>
<span id="cb25-315"><a href="#cb25-315"></a>  <span class="at">width =</span> <span class="dv">7</span>,</span>
<span id="cb25-316"><a href="#cb25-316"></a>  <span class="at">height =</span> <span class="dv">12</span>,</span>
<span id="cb25-317"><a href="#cb25-317"></a>  <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb25-318"><a href="#cb25-318"></a>  <span class="at">device =</span> <span class="st">"svg"</span></span>
<span id="cb25-319"><a href="#cb25-319"></a>)</span>
<span id="cb25-320"><a href="#cb25-320"></a><span class="in">```</span></span>
<span id="cb25-321"><a href="#cb25-321"></a></span>
<span id="cb25-322"><a href="#cb25-322"></a>::: {#fig-01}</span>
<span id="cb25-325"><a href="#cb25-325"></a><span class="in">```{r}</span></span>
<span id="cb25-326"><a href="#cb25-326"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb25-327"><a href="#cb25-327"></a><span class="co">#| fig-height: 14</span></span>
<span id="cb25-328"><a href="#cb25-328"></a><span class="co">#| warning: false</span></span>
<span id="cb25-329"><a href="#cb25-329"></a><span class="co">#| echo: false</span></span>
<span id="cb25-330"><a href="#cb25-330"></a>fig01</span>
<span id="cb25-331"><a href="#cb25-331"></a><span class="in">```</span></span>
<span id="cb25-332"><a href="#cb25-332"></a>Outcomes from pairwise cocultures of both ancestral (left, A:G) and both evolved (right, B:H) 0403, 1287, 1896 and 1977 species. Rows in the grid represent different streptomycin concentrations applied (A:B = 0 µg/ml, C:D = 16 µg/ml, E:F = 64 µg/ml, G:H = 256 µg/ml). Using the rules defined above for competitive outcomes, red lines show "exclusion," dark red show "towards exclusion," light blue lines show "stable coexistence," dark blue lines show "coexistence without evidence for mutual invasion," and green lines show "inconclusive" outcomes. Some statistical noise has been applied to point positions to prevent overlaps in the plot and aid in visualization.</span>
<span id="cb25-333"><a href="#cb25-333"></a>:::</span>
<span id="cb25-334"><a href="#cb25-334"></a></span>
<span id="cb25-335"><a href="#cb25-335"></a>**NOTE:** in panel E (64 µg/ml streptomycin, ANC_0403 vs ANC_1977) both replicates survived with OD ~ 0.15 when ANC_0403 was started from 90% abundance but not when it was started at 10% abundance (OD ~ 0.04). In all replicates of 90%/10% starting abundance ANC_1977 was driven extinct.</span>
<span id="cb25-336"><a href="#cb25-336"></a></span>
<span id="cb25-339"><a href="#cb25-339"></a><span class="in">```{r}</span></span>
<span id="cb25-340"><a href="#cb25-340"></a><span class="co">#| warning: false</span></span>
<span id="cb25-341"><a href="#cb25-341"></a>fig02 <span class="ot">&lt;-</span> patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(samp_pairs_fmt_plots_split_b, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb25-342"><a href="#cb25-342"></a>  patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>)</span>
<span id="cb25-343"><a href="#cb25-343"></a><span class="in">```</span></span>
<span id="cb25-344"><a href="#cb25-344"></a></span>
<span id="cb25-347"><a href="#cb25-347"></a><span class="in">```{r}</span></span>
<span id="cb25-348"><a href="#cb25-348"></a><span class="co">#| eval: false</span></span>
<span id="cb25-349"><a href="#cb25-349"></a><span class="co">#| include: true</span></span>
<span id="cb25-350"><a href="#cb25-350"></a><span class="fu">ggsave</span>(</span>
<span id="cb25-351"><a href="#cb25-351"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"figs"</span>, <span class="st">"coexistence_pairs_mixed_hist.svg"</span>),</span>
<span id="cb25-352"><a href="#cb25-352"></a>  fig02,</span>
<span id="cb25-353"><a href="#cb25-353"></a>  <span class="at">width =</span> <span class="dv">7</span>,</span>
<span id="cb25-354"><a href="#cb25-354"></a>  <span class="at">height =</span> <span class="dv">7</span>,</span>
<span id="cb25-355"><a href="#cb25-355"></a>  <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb25-356"><a href="#cb25-356"></a>  <span class="at">device =</span> <span class="st">"svg"</span></span>
<span id="cb25-357"><a href="#cb25-357"></a>)</span>
<span id="cb25-358"><a href="#cb25-358"></a><span class="in">```</span></span>
<span id="cb25-359"><a href="#cb25-359"></a></span>
<span id="cb25-360"><a href="#cb25-360"></a>::: {#fig-02}</span>
<span id="cb25-363"><a href="#cb25-363"></a><span class="in">```{r}</span></span>
<span id="cb25-364"><a href="#cb25-364"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb25-365"><a href="#cb25-365"></a><span class="co">#| fig-height: 7</span></span>
<span id="cb25-366"><a href="#cb25-366"></a><span class="co">#| warning: false</span></span>
<span id="cb25-367"><a href="#cb25-367"></a><span class="co">#| echo: false</span></span>
<span id="cb25-368"><a href="#cb25-368"></a>fig02</span>
<span id="cb25-369"><a href="#cb25-369"></a><span class="in">```</span></span>
<span id="cb25-370"><a href="#cb25-370"></a>Results from co-cultures of mixed ancestral and evolved combinations. Line colors and types are as in @fig-01.</span>
<span id="cb25-371"><a href="#cb25-371"></a>:::</span>
<span id="cb25-372"><a href="#cb25-372"></a></span>
<span id="cb25-373"><a href="#cb25-373"></a><span class="fu"># Network</span></span>
<span id="cb25-374"><a href="#cb25-374"></a></span>
<span id="cb25-375"><a href="#cb25-375"></a>Here we will plot the pairwise competition outcomes as a network. **NOTE:** I don't have time/energy to figure out how to manage all the links in the networks so that they line up properly and don't overlap so there will need to be some postprocessing in inkscape to move some of the links so they don't overlap.</span>
<span id="cb25-376"><a href="#cb25-376"></a></span>
<span id="cb25-379"><a href="#cb25-379"></a><span class="in">```{r}</span></span>
<span id="cb25-380"><a href="#cb25-380"></a><span class="co">#| output: false</span></span>
<span id="cb25-381"><a href="#cb25-381"></a><span class="fu">library</span>(ggraph)</span>
<span id="cb25-382"><a href="#cb25-382"></a><span class="fu">library</span>(tidygraph)</span>
<span id="cb25-383"><a href="#cb25-383"></a><span class="in">```</span></span>
<span id="cb25-384"><a href="#cb25-384"></a></span>
<span id="cb25-385"><a href="#cb25-385"></a><span class="fu">## Evolution and Streptomycin categories separate</span></span>
<span id="cb25-386"><a href="#cb25-386"></a></span>
<span id="cb25-387"><a href="#cb25-387"></a>Here we plot a separate graph for each streptomycin concentrations and also by different evolutionary groupings. For example, there is one graph for the competition outcomes of only ancestral species, there is one graph of the outcomes of only evolved species, and there is one graph for the outcomes of mixed competitions where an ancestral species competes against an evolved species.</span>
<span id="cb25-388"><a href="#cb25-388"></a></span>
<span id="cb25-391"><a href="#cb25-391"></a><span class="in">```{r}</span></span>
<span id="cb25-392"><a href="#cb25-392"></a><span class="co">#| warning: false</span></span>
<span id="cb25-393"><a href="#cb25-393"></a>nodes1 <span class="ot">&lt;-</span> <span class="fu">make_nodes</span>(samp_pairs_fmt, evo_group, strep_conc)</span>
<span id="cb25-394"><a href="#cb25-394"></a>edges1 <span class="ot">&lt;-</span> <span class="fu">make_edges</span>(samp_pairs_fmt, evo_group, strep_conc)</span>
<span id="cb25-395"><a href="#cb25-395"></a></span>
<span id="cb25-396"><a href="#cb25-396"></a>graphs1 <span class="ot">&lt;-</span> <span class="fu">nest</span>(nodes1, <span class="at">sps =</span> <span class="sc">-</span><span class="fu">c</span>(evo_group, strep_conc)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-397"><a href="#cb25-397"></a>  <span class="fu">left_join</span>(<span class="fu">nest</span>(edges1, <span class="at">pairs =</span> <span class="sc">-</span><span class="fu">c</span>(evo_group, strep_conc)),</span>
<span id="cb25-398"><a href="#cb25-398"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(evo_group, strep_conc)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-399"><a href="#cb25-399"></a>  <span class="fu">mutate</span>(<span class="at">network =</span> <span class="fu">map2</span>(sps, pairs, <span class="cf">function</span>(sps, pairs) <span class="fu">tbl_graph</span>(<span class="at">nodes =</span> sps, <span class="at">edges =</span> pairs, <span class="at">directed =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb25-400"><a href="#cb25-400"></a>  <span class="fu">mutate</span>(<span class="at">plot =</span> <span class="fu">map</span>(network, <span class="cf">function</span>(network) <span class="fu">plot_network_hierarchy</span>(network, <span class="at">tune_angle =</span> <span class="fl">1.5</span>, <span class="at">n_rank =</span> <span class="dv">7</span>, <span class="at">n_break =</span> <span class="dv">7</span>)))</span>
<span id="cb25-401"><a href="#cb25-401"></a><span class="in">```</span></span>
<span id="cb25-402"><a href="#cb25-402"></a></span>
<span id="cb25-403"><a href="#cb25-403"></a></span>
<span id="cb25-406"><a href="#cb25-406"></a><span class="in">```{r}</span></span>
<span id="cb25-407"><a href="#cb25-407"></a><span class="co">#| warning: false</span></span>
<span id="cb25-408"><a href="#cb25-408"></a>fig03 <span class="ot">&lt;-</span> patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(graphs1[[<span class="dv">6</span>]], <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">guides=</span> <span class="st">"collect"</span>) <span class="sc">+</span></span>
<span id="cb25-409"><a href="#cb25-409"></a>  patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>)</span>
<span id="cb25-410"><a href="#cb25-410"></a><span class="in">```</span></span>
<span id="cb25-411"><a href="#cb25-411"></a></span>
<span id="cb25-414"><a href="#cb25-414"></a><span class="in">```{r}</span></span>
<span id="cb25-415"><a href="#cb25-415"></a><span class="co">#| eval: false</span></span>
<span id="cb25-416"><a href="#cb25-416"></a><span class="co">#| include: true</span></span>
<span id="cb25-417"><a href="#cb25-417"></a><span class="fu">ggsave</span>(</span>
<span id="cb25-418"><a href="#cb25-418"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"figs"</span>, <span class="st">"coexistence_networks_nested_evo_strep.svg"</span>),</span>
<span id="cb25-419"><a href="#cb25-419"></a>  fig03,</span>
<span id="cb25-420"><a href="#cb25-420"></a>  <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb25-421"><a href="#cb25-421"></a>  <span class="at">height =</span> <span class="dv">10</span>,</span>
<span id="cb25-422"><a href="#cb25-422"></a>  <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb25-423"><a href="#cb25-423"></a>  <span class="at">device =</span> <span class="st">"svg"</span></span>
<span id="cb25-424"><a href="#cb25-424"></a>)</span>
<span id="cb25-425"><a href="#cb25-425"></a><span class="in">```</span></span>
<span id="cb25-426"><a href="#cb25-426"></a></span>
<span id="cb25-427"><a href="#cb25-427"></a>::: {#fig-03}</span>
<span id="cb25-430"><a href="#cb25-430"></a><span class="in">```{r}</span></span>
<span id="cb25-431"><a href="#cb25-431"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb25-432"><a href="#cb25-432"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb25-433"><a href="#cb25-433"></a><span class="co">#| warning: false</span></span>
<span id="cb25-434"><a href="#cb25-434"></a><span class="co">#| echo: false</span></span>
<span id="cb25-435"><a href="#cb25-435"></a>fig03</span>
<span id="cb25-436"><a href="#cb25-436"></a><span class="in">```</span></span>
<span id="cb25-437"><a href="#cb25-437"></a>Competitive hierarchy of species pairs separated by evolution grouping (only ancestral pairs, only evolved pairs, and mixed ancestral and evolved pairs) and streptomycin concentration. Subplots A-D are for only ancestral pairs, E-H for only evolved pairs, and I-L for mixed ancestral and evolved pairs. Subplots A, E, I show experiments under no streptomycin, B, F, J 16 µg/ml streptomycin, C, G, K for 64 µg/ml streptomycin, and D, H, L for 256 µg/ml streptomycin. For each evolution/streptomycin grouping, strains are rank ordered on the basis of the number of other strains they exclude, based on data shown in @fig-01 and @fig-02. Grey nodes represent strains (denoted by text), red arrows point from winning strain to losing strain, blue arrows indicate coexistence (ignore the arrow heads for blue, coulnd't figure out how to remove them for only a subset of the edges).</span>
<span id="cb25-438"><a href="#cb25-438"></a>:::</span>
<span id="cb25-439"><a href="#cb25-439"></a></span>
<span id="cb25-440"><a href="#cb25-440"></a><span class="fu">## Only Streptomycin category separate</span></span>
<span id="cb25-441"><a href="#cb25-441"></a></span>
<span id="cb25-444"><a href="#cb25-444"></a><span class="in">```{r}</span></span>
<span id="cb25-445"><a href="#cb25-445"></a><span class="co">#| warning: false</span></span>
<span id="cb25-446"><a href="#cb25-446"></a>nodes2 <span class="ot">&lt;-</span> <span class="fu">make_nodes</span>(samp_pairs_fmt, strep_conc)</span>
<span id="cb25-447"><a href="#cb25-447"></a>edges2 <span class="ot">&lt;-</span> <span class="fu">make_edges</span>(samp_pairs_fmt, strep_conc)</span>
<span id="cb25-448"><a href="#cb25-448"></a></span>
<span id="cb25-449"><a href="#cb25-449"></a>graphs2 <span class="ot">&lt;-</span> <span class="fu">nest</span>(nodes2, <span class="at">sps =</span> <span class="sc">-</span><span class="fu">c</span>(strep_conc)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-450"><a href="#cb25-450"></a>  <span class="fu">left_join</span>(<span class="fu">nest</span>(edges2, <span class="at">pairs =</span> <span class="sc">-</span><span class="fu">c</span>(strep_conc)),</span>
<span id="cb25-451"><a href="#cb25-451"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(strep_conc)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-452"><a href="#cb25-452"></a>  <span class="fu">mutate</span>(<span class="at">network =</span> <span class="fu">map2</span>(sps, pairs, <span class="cf">function</span>(sps, pairs) <span class="fu">tbl_graph</span>(<span class="at">nodes =</span> sps, <span class="at">edges =</span> pairs, <span class="at">directed =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb25-453"><a href="#cb25-453"></a>  <span class="fu">mutate</span>(<span class="at">plot =</span> <span class="fu">map</span>(network, <span class="cf">function</span>(network) <span class="fu">plot_network_hierarchy</span>(network, <span class="at">tune_angle =</span> <span class="fl">1.5</span>, <span class="at">n_rank =</span> <span class="dv">7</span>, <span class="at">n_break =</span> <span class="dv">7</span>)))</span>
<span id="cb25-454"><a href="#cb25-454"></a><span class="in">```</span></span>
<span id="cb25-455"><a href="#cb25-455"></a></span>
<span id="cb25-458"><a href="#cb25-458"></a><span class="in">```{r}</span></span>
<span id="cb25-459"><a href="#cb25-459"></a><span class="co">#| warning: false</span></span>
<span id="cb25-460"><a href="#cb25-460"></a>fig04 <span class="ot">&lt;-</span> patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(graphs2[[<span class="dv">5</span>]], <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">guides=</span> <span class="st">"collect"</span>) <span class="sc">+</span></span>
<span id="cb25-461"><a href="#cb25-461"></a>  patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>)</span>
<span id="cb25-462"><a href="#cb25-462"></a><span class="in">```</span></span>
<span id="cb25-463"><a href="#cb25-463"></a></span>
<span id="cb25-466"><a href="#cb25-466"></a><span class="in">```{r}</span></span>
<span id="cb25-467"><a href="#cb25-467"></a><span class="co">#| eval: false</span></span>
<span id="cb25-468"><a href="#cb25-468"></a><span class="co">#| include: true</span></span>
<span id="cb25-469"><a href="#cb25-469"></a><span class="fu">ggsave</span>(</span>
<span id="cb25-470"><a href="#cb25-470"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"figs"</span>, <span class="st">"coexistence_networks_nested_strep.svg"</span>),</span>
<span id="cb25-471"><a href="#cb25-471"></a>  fig04,</span>
<span id="cb25-472"><a href="#cb25-472"></a>  <span class="at">width =</span> <span class="dv">9</span>,</span>
<span id="cb25-473"><a href="#cb25-473"></a>  <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb25-474"><a href="#cb25-474"></a>  <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb25-475"><a href="#cb25-475"></a>  <span class="at">device =</span> <span class="st">"svg"</span></span>
<span id="cb25-476"><a href="#cb25-476"></a>)</span>
<span id="cb25-477"><a href="#cb25-477"></a><span class="in">```</span></span>
<span id="cb25-478"><a href="#cb25-478"></a></span>
<span id="cb25-479"><a href="#cb25-479"></a>::: {#fig-04}</span>
<span id="cb25-482"><a href="#cb25-482"></a><span class="in">```{r}</span></span>
<span id="cb25-483"><a href="#cb25-483"></a><span class="co">#| fig-width: 9</span></span>
<span id="cb25-484"><a href="#cb25-484"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb25-485"><a href="#cb25-485"></a><span class="co">#| warning: false</span></span>
<span id="cb25-486"><a href="#cb25-486"></a><span class="co">#| echo: false</span></span>
<span id="cb25-487"><a href="#cb25-487"></a>fig04</span>
<span id="cb25-488"><a href="#cb25-488"></a><span class="in">```</span></span>
<span id="cb25-489"><a href="#cb25-489"></a>Competitive hierarchy of species pairs separated by streptomycin concentration. Subplot A shows experiments under no streptomycin, B with 16 µg/ml streptomycin, C with 64 µg/ml streptomycin, and D with 256 µg/ml streptomycin. For each evolution/streptomycin grouping, strains are rank ordered on the basis of the number of other strains they exclude, based on data shown in @fig-01 and @fig-02. Grey nodes represent strains (denoted by text), red arrows point from winning strain to losing strain, blue arrows indicate coexistence (ignore the arrow heads for blue, couldn't figure out how to remove them for only a subset of the edges)</span>
<span id="cb25-490"><a href="#cb25-490"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>